apiVersion: v1
kind: ServiceAccount
metadata:
  annotations:
    kots.io/app-slug: gitpod
  labels:
    app.kubernetes.io/instance: fluent-bit
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: fluent-bit
    app.kubernetes.io/version: 1.9.4
    helm.sh/chart: fluent-bit-0.20.2
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: fluent-bit
---
apiVersion: v1
kind: ServiceAccount
metadata:
  annotations:
    kots.io/app-slug: gitpod
  labels:
    app: gitpod
    component: gitpod-installer
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: installer
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations:
    kots.io/app-slug: gitpod
  labels:
    app.kubernetes.io/instance: fluent-bit
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: fluent-bit
    app.kubernetes.io/version: 1.9.4
    helm.sh/chart: fluent-bit-0.20.2
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: fluent-bit
rules:
- apiGroups:
  - ""
  resources:
  - namespaces
  - pods
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations:
    kots.io/app-slug: gitpod
  labels:
    app.kubernetes.io/instance: fluent-bit
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: fluent-bit
    app.kubernetes.io/version: 1.9.4
    helm.sh/chart: fluent-bit-0.20.2
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: fluent-bit
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: fluent-bit
subjects:
- kind: ServiceAccount
  name: fluent-bit
  namespace: gitpod
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations:
    kots.io/app-slug: gitpod
  labels:
    app: gitpod
    component: gitpod-installer
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: installer
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: installer
  namespace: gitpod
---
apiVersion: v1
data:
  custom_parsers.conf: |
    [PARSER]
        Name docker_no_time
        Format json
        Time_Keep Off
        Time_Key time
        Time_Format %Y-%m-%dT%H:%M:%S.%L
  fluent-bit.conf: |
    [SERVICE]
        Daemon Off
        Flush 1
        Log_Level info
        Parsers_File parsers.conf
        Parsers_File custom_parsers.conf
        HTTP_Server On
        HTTP_Listen 0.0.0.0
        HTTP_Port 2020
        Health_Check On

    [INPUT]
        Name tail
        Path /var/log/containers/*.log
        Parser docker
        Tag <pod_name>.<container_name>
        Tag_Regex (?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*)_(?<namespace_name>[^_]+)_(?<container_name>.+)-
        Skip_Long_Lines On

    [FILTER]
        Name stdout

    [OUTPUT]
        Name file
        Match imagebuild*
        Mkdir true
        Path /gitpod/log-collector
        Format plain

    [OUTPUT]
        Name file
        Match installer*
        Mkdir true
        Path /gitpod/log-collector
        Format plain

    # Workspaces
    [OUTPUT]
        Name file
        Match ws*.workspace
        Mkdir true
        Path /gitpod/log-collector
        Format plain
kind: ConfigMap
metadata:
  annotations:
    kots.io/app-slug: gitpod
  labels:
    app.kubernetes.io/instance: fluent-bit
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: fluent-bit
    app.kubernetes.io/version: 1.9.4
    helm.sh/chart: fluent-bit-0.20.2
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: fluent-bit
---
apiVersion: v1
data:
  gitpod-config-patch.yaml: e30=
kind: ConfigMap
metadata:
  annotations:
    kots.io/app-slug: gitpod
  labels:
    app: gitpod
    component: gitpod-installer
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: gitpod-config-patch
---
apiVersion: v1
data:
  channelName: Stable
  cursor: "18"
  isAirgap: "false"
  releaseNotes: "# August 2022 release of Gitpod Installer\n\nDocker image: `eu.gcr.io/gitpod-core-dev/build/installer:release-2022.08.0.0`\n\nPlease
    see the [changelog](https://www.gitpod.io/changelog/august-self-hosted-release)
    for more information. \n\nRefer to the [self-hosted documentation](https://www.gitpod.io/docs/self-hosted/latest)
    to know more about how to setup Gitpod.\n\n\n## Highlights\n\n- [12336](https://github.com/gitpod-io/gitpod/pull/12336):
    Removal of PodSecurityPolicies. These were deprecated from Kubernetes 1.21 and
    removed from 1.25. This allows Gitpod to run on Kubernetes 1.25+, which is scheduled
    for imminent release\n- [12398](https://github.com/gitpod-io/gitpod/pull/12398):
    Enable base workspace images to be pulled from a private container registry\n\n##
    What's Changed\n* [usage] Add ReconcileUsage RPC by @easyCZ in https://github.com/gitpod-io/gitpod/pull/11676\n*
    [intellij] Update IDE image to build version 222.3345.118 by @github-actions in
    https://github.com/gitpod-io/gitpod/pull/11680\n* [bitbucket] make less requests
    and fail on error by @svenefftinge in https://github.com/gitpod-io/gitpod/pull/11651\n*
    [dashboard] Move PVC feature flag to context by @andrew-farries in https://github.com/gitpod-io/gitpod/pull/11672\n*
    [usage] Have spinner while loading by @laushinka in https://github.com/gitpod-io/gitpod/pull/11687\n*
    [kots]: put the \"run\" collectors into the active namespace by @MrSimonEmms in
    https://github.com/gitpod-io/gitpod/pull/11698\n* Check the pod label to determine
    the PVC feature flag is set by @jenting in https://github.com/gitpod-io/gitpod/pull/11669\n*
    [billing] GetLatestInvoice RPC protos by @easyCZ in https://github.com/gitpod-io/gitpod/pull/11693\n*
    [ws-manager] fix incorrect handling of failure state for workspaces  by @sagor999
    in https://github.com/gitpod-io/gitpod/pull/11489\n* previewctl: install-context
    honors the branch name by @jenting in https://github.com/gitpod-io/gitpod/pull/11711\n*
    Automatically create Pull Requests for updating the Platform Version from JetBrains
    Plugins when available by @felladrin in https://github.com/gitpod-io/gitpod/pull/11657\n*
    Fix openvsx-proxy metrics by @vulkoingim in https://github.com/gitpod-io/gitpod/pull/11699\n*
    [changelog] updated changelog by @roboquat in https://github.com/gitpod-io/gitpod/pull/11708\n*
    Update 'create-pull-request' GitHub Action to v4 by @felladrin in https://github.com/gitpod-io/gitpod/pull/11721\n*
    Update Platform Version from JetBrains Gateway Plugin by @github-actions in https://github.com/gitpod-io/gitpod/pull/11720\n*
    Revert the ws-daemon max unavailable back to wsdaemonMaxAttempts by @jenting in
    https://github.com/gitpod-io/gitpod/pull/11719\n* Filter grpc health check from
    tracing by @aledbf in https://github.com/gitpod-io/gitpod/pull/11705\n* Fix \"how
    to test\" instructions, commit message, and branch name of Pull Requests created
    by the GitHub Action by @felladrin in https://github.com/gitpod-io/gitpod/pull/11724\n*
    [pycharm] Update IDE image to build version 222.3345.131 by @github-actions in
    https://github.com/gitpod-io/gitpod/pull/11728\n* [ws-daemon] Increase WaitForContainer
    timeout by @aledbf in https://github.com/gitpod-io/gitpod/pull/11726\n* [ws-manager]
    Handle Pending pod due to Unschedulable reason by @aledbf in https://github.com/gitpod-io/gitpod/pull/11690\n*
    [ws-daemon] Configure plugins log level to Debug by @aledbf in https://github.com/gitpod-io/gitpod/pull/11733\n*
    [installer] updating the refCache image in image-builder-mk3 by @nandajavarma
    in https://github.com/gitpod-io/gitpod/pull/11727\n* Add label to differentiate
    backup/restore total/failure is PVC or GCS by @jenting in https://github.com/gitpod-io/gitpod/pull/11723\n*
    Add openvsx alert by @jeanp413 in https://github.com/gitpod-io/gitpod/pull/11717\n*
    [changelog] updated changelog by @roboquat in https://github.com/gitpod-io/gitpod/pull/11734\n*
    [local-preview] Add new Telemetry by @Pothulapati in https://github.com/gitpod-io/gitpod/pull/11642\n*
    [integration-test] re-enable jetbrains inte test by @iQQBot in https://github.com/gitpod-io/gitpod/pull/11627\n*
    [goland] Update IDE image to build version 222.3345.118 by @github-actions in
    https://github.com/gitpod-io/gitpod/pull/11744\n* Add alert for OpenVSX-proxy
    scraping failures by @ArthurSens in https://github.com/gitpod-io/gitpod/pull/11746\n*
    [code] build stable image for 1.69 with in-product changelog and port… by @mustard-mh
    in https://github.com/gitpod-io/gitpod/pull/11753\n* [code] update stable code
    for 1.69 with in-product changelog and port… by @mustard-mh in https://github.com/gitpod-io/gitpod/pull/11754\n*
    Correct const variable naming. It should be a label, not an annotation by @jenting
    in https://github.com/gitpod-io/gitpod/pull/11741\n* Add alert for target down
    by @ArthurSens in https://github.com/gitpod-io/gitpod/pull/11745\n* Remove the
    PVC object if the workspace pod is never been ready by @jenting in https://github.com/gitpod-io/gitpod/pull/11644\n*
    [changelog] updated changelog by @roboquat in https://github.com/gitpod-io/gitpod/pull/11758\n*
    [docker-up] Update docker compose to v2.8.0 by @aledbf in https://github.com/gitpod-io/gitpod/pull/11761\n*
    [dashboard] Hide PVC feature section when feat flag not set by @andrew-farries
    in https://github.com/gitpod-io/gitpod/pull/11674\n* [server] add http endpoint
    workspacePageClose for beacon by @mustard-mh in https://github.com/gitpod-io/gitpod/pull/11643\n*
    Fix find authorized user for GHE prebuilds by @AlexTugarev in https://github.com/gitpod-io/gitpod/pull/11570\n*
    [changelog] updated changelog by @roboquat in https://github.com/gitpod-io/gitpod/pull/11762\n*
    Add cronjob to cleanup preview environments by @nandajavarma in https://github.com/gitpod-io/gitpod/pull/11473\n*
    [usage] Extend method call with order arg by @laushinka in https://github.com/gitpod-io/gitpod/pull/11694\n*
    [server] Tie protected_secrets to ConfigCag by @csweichel in https://github.com/gitpod-io/gitpod/pull/11765\n*
    Remove check for absence by @ArthurSens in https://github.com/gitpod-io/gitpod/pull/11772\n*
    [usage] Fix arguments to the listBilledUsage call by @laushinka in https://github.com/gitpod-io/gitpod/pull/11773\n*
    [usage] Delay gRPC self connection by @andrew-farries in https://github.com/gitpod-io/gitpod/pull/11747\n*
    [usage] Enable sorting in the UI by @laushinka in https://github.com/gitpod-io/gitpod/pull/11774\n*
    [ws-daemon] Increase resources more real values by @aledbf in https://github.com/gitpod-io/gitpod/pull/11779\n*
    [ws-manager] fix not handling workspaces that are completed by @sagor999 in https://github.com/gitpod-io/gitpod/pull/11781\n*
    [installer-tests] Support tests against multiple version of k8s and ubuntu images
    by @nandajavarma in https://github.com/gitpod-io/gitpod/pull/11568\n* Update feedback
    issue template by @gtsiolis in https://github.com/gitpod-io/gitpod/pull/11244\n*
    Add kube-rbac-proxy to content-service by @ArthurSens in https://github.com/gitpod-io/gitpod/pull/11782\n*
    Display alert in \"No seats\" scenario by @geropl in https://github.com/gitpod-io/gitpod/pull/11768\n*
    [content-service] Make the name of the usage report bucket configurable by @andrew-farries
    in https://github.com/gitpod-io/gitpod/pull/11689\n* Check instance ID and workspace
    ID are not empty by @jenting in https://github.com/gitpod-io/gitpod/pull/11788\n*
    Revert \"TEST COMMIT\" by @geropl in https://github.com/gitpod-io/gitpod/pull/11793\n*
    [usage] Ensure `Content-Type` headers are set for GCP object storage uploads by
    @andrew-farries in https://github.com/gitpod-io/gitpod/pull/11730\n* Ensure workspace
    is only deleted once by @Furisto in https://github.com/gitpod-io/gitpod/pull/11799\n*
    [dashboard] Next steps nudge for local-preview  by @Pothulapati in https://github.com/gitpod-io/gitpod/pull/11434\n*
    [usage] Implement CollectUsage by @easyCZ in https://github.com/gitpod-io/gitpod/pull/11681\n*
    [installer]: create tests to verify render result by @MrSimonEmms in https://github.com/gitpod-io/gitpod/pull/11288\n*
    Add observability debug on failure by @liam-j-bennett in https://github.com/gitpod-io/gitpod/pull/11805\n*
    [public-api] Add a placeholder Stripe webhook by @andrew-farries in https://github.com/gitpod-io/gitpod/pull/11806\n*
    Fix the sleep in the cmd by @liam-j-bennett in https://github.com/gitpod-io/gitpod/pull/11810\n*
    Provide better error message for HTTP 524 by @Furisto in https://github.com/gitpod-io/gitpod/pull/11808\n*
    [usage] Add metrics for number of usage records by @easyCZ in https://github.com/gitpod-io/gitpod/pull/11797\n*
    Detach dangling base mounts by @Furisto in https://github.com/gitpod-io/gitpod/pull/11802\n*
    [ws-manager] improve tracing and fix lock by @sagor999 in https://github.com/gitpod-io/gitpod/pull/11784\n*
    Add annotation gitpod.io/startedDisposal ealier by @jenting in https://github.com/gitpod-io/gitpod/pull/11826\n*
    [server] better handle workspacePageClose endpoint response status and log ctx
    by @mustard-mh in https://github.com/gitpod-io/gitpod/pull/11817\n* Get the Installer
    dependencies for every workspace by @MrSimonEmms in https://github.com/gitpod-io/gitpod/pull/11829\n*
    [dashboard] Fix rendering of the redirect URI on Git Integrations page by @AlexTugarev
    in https://github.com/gitpod-io/gitpod/pull/11798\n* [dashboard] Fix displaying
    of logs for finished Prebuilds by @geropl in https://github.com/gitpod-io/gitpod/pull/11827\n*
    Don't compile previewctl on workspace-startup by @meysholdt in https://github.com/gitpod-io/gitpod/pull/11840\n*
    Update `marketplace.json` by @filiptronicek in https://github.com/gitpod-io/gitpod/pull/11778\n*
    [usage] Improve pagination behavior by @laushinka in https://github.com/gitpod-io/gitpod/pull/11800\n*
    add log when starting workspace with pvc by @sagor999 in https://github.com/gitpod-io/gitpod/pull/11824\n*
    Replace with sorting icon by @laushinka in https://github.com/gitpod-io/gitpod/pull/11815\n*
    [ws-manager] Disable PVC feature by @aledbf in https://github.com/gitpod-io/gitpod/pull/11850\n*
    Update README.md by @shannonkinney95 in https://github.com/gitpod-io/gitpod/pull/11819\n*
    Add support for HTTP_PROXY, HTTPS_PROXY and NO_PROXY in probes by @aledbf in https://github.com/gitpod-io/gitpod/pull/11853\n*
    Revert add annotation gitpod.io/startedDisposal earlier by @jenting in https://github.com/gitpod-io/gitpod/pull/11859\n*
    [code] Point to 1.70 release branch by @jeanp413 in https://github.com/gitpod-io/gitpod/pull/11851\n*
    [installer] Support configuration of the public API HTTP port by @andrew-farries
    in https://github.com/gitpod-io/gitpod/pull/11832\n* [usage] Self-connection allows
    up to 30MB in message response by @easyCZ in https://github.com/gitpod-io/gitpod/pull/11841\n*
    [dashboard] Optimization: Don't wait before fetching a team's spending limit by
    @jankeromnes in https://github.com/gitpod-io/gitpod/pull/11863\n* Remove backup
    trail by @aledbf in https://github.com/gitpod-io/gitpod/pull/11807\n* [usage]
    Add alert on failed reconciliations by @easyCZ in https://github.com/gitpod-io/gitpod/pull/11864\n*
    [installer] Add missing output.golden changes of #11807 by @corneliusludmann in
    https://github.com/gitpod-io/gitpod/pull/11869\n* [installer] Fix writing golden
    files by @corneliusludmann in https://github.com/gitpod-io/gitpod/pull/11872\n*
    Log warning instead of tracing error span by @jenting in https://github.com/gitpod-io/gitpod/pull/11830\n*
    previews: Add preview owner reference to certificates by @ArthurSens in https://github.com/gitpod-io/gitpod/pull/11855\n*
    Remove fixed resources by @Furisto in https://github.com/gitpod-io/gitpod/pull/11838\n*
    [usage] Configure ingress for Stripe webhook by @andrew-farries in https://github.com/gitpod-io/gitpod/pull/11866\n*
    [installer] Small render test improvements by @corneliusludmann in https://github.com/gitpod-io/gitpod/pull/11876\n*
    [gpctl] Add workspace type to workspaces list by @easyCZ in https://github.com/gitpod-io/gitpod/pull/11870\n*
    [server] Introduce EntitlementServiceChargbee and move relevant parts of EligibilityService
    into it by @geropl in https://github.com/gitpod-io/gitpod/pull/11831\n* [code]
    update stable code image to fix changelog related url not works by @mustard-mh
    in https://github.com/gitpod-io/gitpod/pull/11877\n* [db][usage] Add d_b_billed_session
    table migration and Go definitions by @jankeromnes in https://github.com/gitpod-io/gitpod/pull/11868\n*
    Fixed some spelling errors in README.md by @AMetIR in https://github.com/gitpod-io/gitpod/pull/11548\n*
    Introduce BillingMode (1/4) by @geropl in https://github.com/gitpod-io/gitpod/pull/11812\n*
    [billing] Report metrics on updated subscriptions by @easyCZ in https://github.com/gitpod-io/gitpod/pull/11842\n*
    [content-service] handle git access denied error by @sagor999 in https://github.com/gitpod-io/gitpod/pull/11893\n*
    gpctl: support all workspace types. by @utam0k in https://github.com/gitpod-io/gitpod/pull/11898\n*
    [content-init] do not hide error during git checkout by @sagor999 in https://github.com/gitpod-io/gitpod/pull/11895\n*
    [blobserve] Fix lint issues by @aledbf in https://github.com/gitpod-io/gitpod/pull/11896\n*
    [code] build stable code image for 1.70 by @mustard-mh in https://github.com/gitpod-io/gitpod/pull/11899\n*
    [supervisor-frontend] use beacon to send heartbeat to avoid data loss by @mustard-mh
    in https://github.com/gitpod-io/gitpod/pull/11647\n* [usage] Fix UsageReconciliationFailures
    alert by @easyCZ in https://github.com/gitpod-io/gitpod/pull/11890\n* [code] update
    stable code image to 1.70 by @mustard-mh in https://github.com/gitpod-io/gitpod/pull/11900\n*
    [codeowners] Allow all teams to approve installer testdata changes by @corneliusludmann
    in https://github.com/gitpod-io/gitpod/pull/11881\n* Replace AlertBox with Alert
    component by @KevSlashNull in https://github.com/gitpod-io/gitpod/pull/10199\n*
    [ws-daemon] Enable workspace content housekeeping by @csweichel in https://github.com/gitpod-io/gitpod/pull/11809\n*
    [UBP] Add `FinalizeInvoice` RPC to billing service  by @andrew-farries in https://github.com/gitpod-io/gitpod/pull/11903\n*
    [installer] Ensure stable ordering of rendered K8s objects by @corneliusludmann
    in https://github.com/gitpod-io/gitpod/pull/11879\n* [installer] Add external
    registry test by @corneliusludmann in https://github.com/gitpod-io/gitpod/pull/11880\n*
    [server] Add missing @injectable() by @geropl in https://github.com/gitpod-io/gitpod/pull/11907\n*
    [usage] Fix max call send message size by @easyCZ in https://github.com/gitpod-io/gitpod/pull/11908\n*
    [code] point nightly job back to gp-code/main by @mustard-mh in https://github.com/gitpod-io/gitpod/pull/11905\n*
    Refactor EntitlementService and extract License from Chargebee (2/3) by @geropl
    in https://github.com/gitpod-io/gitpod/pull/11889\n* [kots]: only add to base
    image allow list in airgapped mode by @MrSimonEmms in https://github.com/gitpod-io/gitpod/pull/11878\n*
    IDE metrics server by @iQQBot in https://github.com/gitpod-io/gitpod/pull/11542\n*
    When starting a workspace but usage attribution is unclear, prompt for explicit
    user choice by @jankeromnes in https://github.com/gitpod-io/gitpod/pull/11777\n*
    [ws-daemon] Log update of resource limits by @Furisto in https://github.com/gitpod-io/gitpod/pull/11920\n*
    BillingMode: add Json RPC API methods (2/4) by @geropl in https://github.com/gitpod-io/gitpod/pull/11813\n*
    [usage] Add runbook link for GitpodUsageScheduledReconciliationFailures by @easyCZ
    in https://github.com/gitpod-io/gitpod/pull/11922\n* [usage] Add `billInstancesAfter`
    config setting by @andrew-farries in https://github.com/gitpod-io/gitpod/pull/11882\n*
    [dashboard] fix arbitrary useEffect by @AlexTugarev in https://github.com/gitpod-io/gitpod/pull/11923\n*
    [installer] Support setting `billInstancesAfter` by @andrew-farries in https://github.com/gitpod-io/gitpod/pull/11883\n*
    [usage] Add grpc client metrics, up max call sizes by @easyCZ in https://github.com/gitpod-io/gitpod/pull/11925\n*
    [UBP] Add tests and functionality to the Stripe webhook handler by @andrew-farries
    in https://github.com/gitpod-io/gitpod/pull/11921\n* Limit resources based on
    workspace class by @Furisto in https://github.com/gitpod-io/gitpod/pull/11374\n*
    Stop sign on \"out of credits\" by @AlexTugarev in https://github.com/gitpod-io/gitpod/pull/11576\n*
    [usage] Proto changes for markBilledSession RPC by @laushinka in https://github.com/gitpod-io/gitpod/pull/11909\n*
    Retry doFinalize if gRPC status code is Unavailable by @jenting in https://github.com/gitpod-io/gitpod/pull/11873\n*
    [ide-proxy] add missing path by @iQQBot in https://github.com/gitpod-io/gitpod/pull/11934\n*
    Enable workspace classes feature for teams by @Furisto in https://github.com/gitpod-io/gitpod/pull/11931\n*
    [alerts] change load avg alert to warning and route to Slack by @sagor999 in https://github.com/gitpod-io/gitpod/pull/11420\n*
    Return error to the client and only ignore tracing error by @jenting in https://github.com/gitpod-io/gitpod/pull/11939\n*
    Ignore git error message `does not have any commits yet` by @jenting in https://github.com/gitpod-io/gitpod/pull/11938\n*
    fix log to output all info properly by @sagor999 in https://github.com/gitpod-io/gitpod/pull/11933\n*
    registry-facade: Remove unnecessary varilable declaration. by @utam0k in https://github.com/gitpod-io/gitpod/pull/11948\n*
    Change installer testdata CODEOWNERS to anyone by @mustard-mh in https://github.com/gitpod-io/gitpod/pull/11913\n*
    [phpstorm] Update IDE image to build version 222.3345.135 by @github-actions in
    https://github.com/gitpod-io/gitpod/pull/11804\n* Update Platform Version from
    JetBrains Gateway Plugin by @github-actions in https://github.com/gitpod-io/gitpod/pull/11919\n*
    [changelog] updated changelog by @roboquat in https://github.com/gitpod-io/gitpod/pull/11946\n*
    [kots]: collect the user config in support bundles by @MrSimonEmms in https://github.com/gitpod-io/gitpod/pull/11943\n*
    Update go to v1.19 by @aledbf in https://github.com/gitpod-io/gitpod/pull/11891\n*
    Improve registry-facade HTTP requests resilience by @aledbf in https://github.com/gitpod-io/gitpod/pull/11858\n*
    [dev] Run `gofmt` after Go 1.19 upgrade by @andrew-farries in https://github.com/gitpod-io/gitpod/pull/11958\n*
    [kots]: fix typo which meant wasn't using the appSlug in config collect by @MrSimonEmms
    in https://github.com/gitpod-io/gitpod/pull/11965\n* [common-go] Remove unused
    WorkspaceSupervisorEndpoint helper by @aledbf in https://github.com/gitpod-io/gitpod/pull/11974\n*
    ws-daemon: enhance log by @jenting in https://github.com/gitpod-io/gitpod/pull/11983\n*
    Update the alert description unit by @jenting in https://github.com/gitpod-io/gitpod/pull/11980\n*
    Ensure workspace class is persisted by @Furisto in https://github.com/gitpod-io/gitpod/pull/11957\n*
    [installer]: remove the custom labels from the selector labels by @MrSimonEmms
    in https://github.com/gitpod-io/gitpod/pull/11954\n* BillingMode: Use BillingMode
    to restrict API access (3/4) by @geropl in https://github.com/gitpod-io/gitpod/pull/11814\n*
    Set KOTS/Replicated dependencies to latest by @MrSimonEmms in https://github.com/gitpod-io/gitpod/pull/11766\n*
    [changelog] updated changelog by @roboquat in https://github.com/gitpod-io/gitpod/pull/11978\n*
    [installer]: refactor yq to run against arbitrary strings by @MrSimonEmms in https://github.com/gitpod-io/gitpod/pull/11973\n*
    [supervisor]: gitpod config changed analytics by @akosyakov in https://github.com/gitpod-io/gitpod/pull/11653\n*
    Update Platform Version from JetBrains Backend Plugin by @github-actions in https://github.com/gitpod-io/gitpod/pull/11803\n*
    [ws-daemon] Include workspace id in error by @Furisto in https://github.com/gitpod-io/gitpod/pull/12007\n*
    Add billing setup in sugar by @laushinka in https://github.com/gitpod-io/gitpod/pull/11999\n*
    [goland] Update IDE image to build version 222.3345.146 by @github-actions in
    https://github.com/gitpod-io/gitpod/pull/11994\n* [UBP/baseserver] Allow gRPC
    server to receive much larger messages by @andrew-farries in https://github.com/gitpod-io/gitpod/pull/12003\n*
    Update jetbrains-update-plugin-platform-template.yml by @felladrin in https://github.com/gitpod-io/gitpod/pull/12009\n*
    [dashboard] fix host value for Git Integrations by @AlexTugarev in https://github.com/gitpod-io/gitpod/pull/11993\n*
    Auto-forward all workspace open ports when using Latest JetBrains IDEs by @felladrin
    in https://github.com/gitpod-io/gitpod/pull/11081\n* ws-daemon: add span when
    NewWorkspace by @jenting in https://github.com/gitpod-io/gitpod/pull/12022\n*
    observability: Add a alert for the network connections. by @utam0k in https://github.com/gitpod-io/gitpod/pull/11825\n*
    Upgrade Gradle for compatibility with Java 17 by @felladrin in https://github.com/gitpod-io/gitpod/pull/11991\n*
    Fix redirect on team usage page by @AlexTugarev in https://github.com/gitpod-io/gitpod/pull/12025\n*
    [IDE jobs] only post interesting notifications to Slack by @filiptronicek in https://github.com/gitpod-io/gitpod/pull/11977\n*
    previews: Implement certificate garbage collection by @ArthurSens in https://github.com/gitpod-io/gitpod/pull/11856\n*
    [installer]: use typemeta declaration in the helm customisations by @MrSimonEmms
    in https://github.com/gitpod-io/gitpod/pull/12031\n* Increase threshold for unavailable
    targets by @ArthurSens in https://github.com/gitpod-io/gitpod/pull/12034\n* [UBP]
    Add placeholder implementation of `FinalizeInvoice` by @andrew-farries in https://github.com/gitpod-io/gitpod/pull/11949\n*
    [UBP] Use a realistic event payload in Stripe webhook automated tests by @andrew-farries
    in https://github.com/gitpod-io/gitpod/pull/11985\n* [changelog] updated changelog
    by @roboquat in https://github.com/gitpod-io/gitpod/pull/12016\n* [dashboard]
    Fix active state in usage-based billing account selector by @jankeromnes in https://github.com/gitpod-io/gitpod/pull/12008\n*
    [UBP] Connect Stripe webhook to `FinalizeInvoice` RPC by @andrew-farries in https://github.com/gitpod-io/gitpod/pull/11987\n*
    [installer-tests] Add slack webhook for test failures by @nandajavarma in https://github.com/gitpod-io/gitpod/pull/11749\n*
    EntitlementService Usage-Based Pricing by @geropl in https://github.com/gitpod-io/gitpod/pull/11936\n*
    [installer]: escape inline yaml keys for labels/annotations in Helm by @MrSimonEmms
    in https://github.com/gitpod-io/gitpod/pull/12037\n* Add clone3 to seccomp profile
    syscalls by @aledbf in https://github.com/gitpod-io/gitpod/pull/11976\n* [installer]
    Fix lint issue by @aledbf in https://github.com/gitpod-io/gitpod/pull/12046\n*
    Restrict codeowners of 'supervisor-api' only to '.proto' files by @felladrin in
    https://github.com/gitpod-io/gitpod/pull/12047\n* Replace deprecated seccomp.security.alpha.kubernetes.io/pod
    annotation by @aledbf in https://github.com/gitpod-io/gitpod/pull/11966\n* Remove
    duplication of parsing SUPERVISOR_ADDR by @aledbf in https://github.com/gitpod-io/gitpod/pull/11975\n*
    content-service: check remote branch exists before git checkout by @jenting in
    https://github.com/gitpod-io/gitpod/pull/12044\n* Revert `Replace deprecated seccomp.security.alpha.kubernetes.io/pod
    annotation #11966` by @kylos101 in https://github.com/gitpod-io/gitpod/pull/12058\n*
    [code] build stable code image for 1.70.1 by @jeanp413 in https://github.com/gitpod-io/gitpod/pull/12054\n*
    [usage] Implement markWorkspaceInstanceSessionAsBilled by @laushinka in https://github.com/gitpod-io/gitpod/pull/11888\n*
    [changelog] updated changelog by @roboquat in https://github.com/gitpod-io/gitpod/pull/12055\n*
    Use prebuild workspace class for regular workspaces by @Furisto in https://github.com/gitpod-io/gitpod/pull/11912\n*
    Add support for the new observability installer in preview environments by @mads-hartmann
    in https://github.com/gitpod-io/gitpod/pull/12039\n* observability: add #workspace
    > 20 in alert GitpodWorkspaceTooManyRegularNotActive by @jenting in https://github.com/gitpod-io/gitpod/pull/12059\n*
    [code] update stable code image to 1.70.1 by @jeanp413 in https://github.com/gitpod-io/gitpod/pull/12057\n*
    Fix order of installer testdata ownership by @corneliusludmann in https://github.com/gitpod-io/gitpod/pull/12070\n*
    Add clusterrolebinding to allow kube-rbac-proxy verify tokens by @ArthurSens in
    https://github.com/gitpod-io/gitpod/pull/12042\n* Workspace integration tests:
    Poll for job phase instead of tailing logs by @mads-hartmann in https://github.com/gitpod-io/gitpod/pull/12069\n*
    Fix IntelliJ IDEA detection of Gradle projects from Gitpod repository by @felladrin
    in https://github.com/gitpod-io/gitpod/pull/12032\n* Avoid displaying prebuild-related
    workspaces in the workspaces list from JetBrains Gateway by @felladrin in https://github.com/gitpod-io/gitpod/pull/12074\n*
    [server] Reliably set log the value for volumeSnapshotId by @kylos101 in https://github.com/gitpod-io/gitpod/pull/12056\n*
    [server] maintain workspace instance state by @svenefftinge in https://github.com/gitpod-io/gitpod/pull/12080\n*
    [JetBrains] Show Workspace CPU/Memory resources in control center by @andreafalzetti
    in https://github.com/gitpod-io/gitpod/pull/12053\n* [Gitpod CLI] Highlight current
    task in `gp tasks list` by @andreafalzetti in https://github.com/gitpod-io/gitpod/pull/12052\n*
    Workspace integration tests: Improve message when preview env build job fails
    by @mads-hartmann in https://github.com/gitpod-io/gitpod/pull/12081\n* [bug][usage]
    Fixes return of SetBilledSession by @laushinka in https://github.com/gitpod-io/gitpod/pull/12085\n*
    [Gitpod CLI] Align `gp top` thresholds with JetBrains by @andreafalzetti in https://github.com/gitpod-io/gitpod/pull/12087\n*
    Update Platform Version from stable JetBrains Backend Plugin by @felladrin in
    https://github.com/gitpod-io/gitpod/pull/12006\n* Fix X-Forwarded-* headers in
    openvsx-proxy by @jeanp413 in https://github.com/gitpod-io/gitpod/pull/12071\n*
    [registry-facade] Improve IPFS logging by @aledbf in https://github.com/gitpod-io/gitpod/pull/12101\n*
    [registry-facade] Remove unnecessary check by @aledbf in https://github.com/gitpod-io/gitpod/pull/12106\n*
    Replace deprecated seccomp.security.alpha.kubernetes.io/pod annotation by @aledbf
    in https://github.com/gitpod-io/gitpod/pull/12108\n* Fix workspace integration
    test by @jenting in https://github.com/gitpod-io/gitpod/pull/12110\n* loadgen:
    Slight README improvement. by @utam0k in https://github.com/gitpod-io/gitpod/pull/12127\n*
    [server] Don't redirect to sorry on unrecognized login errors by @jankeromnes
    in https://github.com/gitpod-io/gitpod/pull/12111\n* [dashboard] Show workspace
    class in admin view by @Furisto in https://github.com/gitpod-io/gitpod/pull/12040\n*
    [usage] Use actual date for start time by @laushinka in https://github.com/gitpod-io/gitpod/pull/12123\n*
    [dashboard] allow to open desktop links on app domain by @akosyakov in https://github.com/gitpod-io/gitpod/pull/12102\n*
    redirect to desktop IDE on app domain by @akosyakov in https://github.com/gitpod-io/gitpod/pull/12082\n*
    ws-daemon: ignore error when workspace persistent state location not exist by
    @jenting in https://github.com/gitpod-io/gitpod/pull/12018\n* [usage] Increase
    results per page to 50 by @laushinka in https://github.com/gitpod-io/gitpod/pull/12122\n*
    [server] fix using snapshotBucketId when it is undefined or empty by @sagor999
    in https://github.com/gitpod-io/gitpod/pull/12105\n* removed vscode java pack
    by @akosyakov in https://github.com/gitpod-io/gitpod/pull/12146\n* [kots]: add
    useful links to the KOTS dashboard by @MrSimonEmms in https://github.com/gitpod-io/gitpod/pull/12043\n*
    [dashboard] Make team billing settings accessible only to team owners by @jankeromnes
    in https://github.com/gitpod-io/gitpod/pull/12147\n* [changelog] updated changelog
    by @roboquat in https://github.com/gitpod-io/gitpod/pull/12144\n* [server] Mark
    instances whose image build failed as \"stopped\" by @geropl in https://github.com/gitpod-io/gitpod/pull/12139\n*
    [dashboard] Don't forcefully set spending limit to '1' when the input is empty
    by @jankeromnes in https://github.com/gitpod-io/gitpod/pull/12148\n* [supervisor]
    Make resource status request more resilient by @andreafalzetti in https://github.com/gitpod-io/gitpod/pull/12103\n*
    [kots]: allow for backup of resources in KOTS by @MrSimonEmms in https://github.com/gitpod-io/gitpod/pull/11971\n*
    ws-manager: Fix consistency of disposed ws between ws-daemon and ws-manager by
    @utam0k in https://github.com/gitpod-io/gitpod/pull/12028\n* Match google-protobuf
    version across components by @jeanp413 in https://github.com/gitpod-io/gitpod/pull/12164\n*
    [bridge] Return instances preventing deregistration by @Furisto in https://github.com/gitpod-io/gitpod/pull/12150\n*
    [changelog] updated changelog by @roboquat in https://github.com/gitpod-io/gitpod/pull/12166\n*
    [billing] Check if network connections should be limited by @Furisto in https://github.com/gitpod-io/gitpod/pull/12162\n*
    [code] don't report empty vscode extensions as error by @akosyakov in https://github.com/gitpod-io/gitpod/pull/12132\n*
    feat(supervisor): add resource status severity by @andreafalzetti in https://github.com/gitpod-io/gitpod/pull/12157\n*
    Polish handling of BillingMode by @geropl in https://github.com/gitpod-io/gitpod/pull/12130\n*
    [server] trim rawEvents to avoid DB pollution by @AlexTugarev in https://github.com/gitpod-io/gitpod/pull/12167\n*
    [server] ensure that user that has PVC enabled will not force prebuilds into PVC
    use by @sagor999 in https://github.com/gitpod-io/gitpod/pull/12165\n* Generate
    and apply CRDs for observability CLI installation method by @ArthurSens in https://github.com/gitpod-io/gitpod/pull/12175\n*
    fix race condition when creating notifyPod channel by @sagor999 in https://github.com/gitpod-io/gitpod/pull/12181\n*
    [server] fix workspace PVC always restored from prebuild even if backup already
    exists by @sagor999 in https://github.com/gitpod-io/gitpod/pull/12180\n* [intellij]
    Update IDE image to build version 222.3739.54 by @github-actions in https://github.com/gitpod-io/gitpod/pull/12189\n*
    [usage] Test for and fix negative credits in GenerateUsageReport by @geropl in
    https://github.com/gitpod-io/gitpod/pull/12178\n* [server] Never block getStripePublishableKey/getStripeSetupIntentClie…
    by @geropl in https://github.com/gitpod-io/gitpod/pull/12193\n* [pycharm] Update
    IDE image to build version 222.3739.56 by @github-actions in https://github.com/gitpod-io/gitpod/pull/12187\n*
    [goland] Update IDE image to build version 222.3739.57 by @github-actions in https://github.com/gitpod-io/gitpod/pull/12188\n*
    test: fix the cgroup v2 test. by @utam0k in https://github.com/gitpod-io/gitpod/pull/12168\n*
    Update Platform Version from JetBrains Gateway Plugin by @github-actions in https://github.com/gitpod-io/gitpod/pull/12171\n*
    [dashboard] Improve explicit usage-based billing attribution UX by @jankeromnes
    in https://github.com/gitpod-io/gitpod/pull/12151\n* [installer] Use same domain
    for all tests by @corneliusludmann in https://github.com/gitpod-io/gitpod/pull/12207\n*
    [code] update stable code image to 1.70.2 by @jeanp413 in https://github.com/gitpod-io/gitpod/pull/12191\n*
    Sync terraform EKS module with the reference architecture  by @nandajavarma in
    https://github.com/gitpod-io/gitpod/pull/11995\n* [code] build stable code image
    for 1.70.2 by @jeanp413 in https://github.com/gitpod-io/gitpod/pull/12186\n* [kots]:
    remove help text documenting the limitation on custom labels by @MrSimonEmms in
    https://github.com/gitpod-io/gitpod/pull/12211\n* [JetBrains] Make new features
    available in stable version by @andreafalzetti in https://github.com/gitpod-io/gitpod/pull/12159\n*
    [installer-tests] Consolidate slack alerts to reduce noise by @nandajavarma in
    https://github.com/gitpod-io/gitpod/pull/12205\n* [kots] show `registry_s3` options
    only when `incluster` is enabled by @Pothulapati in https://github.com/gitpod-io/gitpod/pull/12218\n*
    [changelog] updated changelog by @roboquat in https://github.com/gitpod-io/gitpod/pull/12213\n*
    [usage] Show workspace and user details by @laushinka in https://github.com/gitpod-io/gitpod/pull/12135\n*
    [phpstorm] Update IDE image to build version 222.3739.61 by @github-actions in
    https://github.com/gitpod-io/gitpod/pull/12228\n* [kots] Allow users to upload
    a `.docker/config.json` file by @Pothulapati in https://github.com/gitpod-io/gitpod/pull/12174\n*
    Update spending limit modal on workspace start by @gtsiolis in https://github.com/gitpod-io/gitpod/pull/12096\n*
    ws-daemon: Proper use of `content.json` by @utam0k in https://github.com/gitpod-io/gitpod/pull/12214\n*
    ws-manager: Provide more detail of DiposalStatus. by @utam0k in https://github.com/gitpod-io/gitpod/pull/11950\n*
    [terraform] Cleanup messages in tf modules by @nandajavarma in https://github.com/gitpod-io/gitpod/pull/12231\n*
    [supervisor] fix chown of /workspace when using PVC by @sagor999 in https://github.com/gitpod-io/gitpod/pull/12238\n*
    re-enable PVC support by @sagor999 in https://github.com/gitpod-io/gitpod/pull/12014\n*
    ws-manager: Improve the monitor code. by @utam0k in https://github.com/gitpod-io/gitpod/pull/12249\n*
    [usage] Change instance runtime calculation: creationTime → startedTime, stoppedTime
    → stoppingTime by @jankeromnes in https://github.com/gitpod-io/gitpod/pull/12195\n*
    Truncate project environment variable name by @gtsiolis in https://github.com/gitpod-io/gitpod/pull/12234\n*
    Add phone verification by @svenefftinge in https://github.com/gitpod-io/gitpod/pull/11346\n*
    [changelog] updated changelog by @roboquat in https://github.com/gitpod-io/gitpod/pull/12247\n*
    [usage] Add config for billInstancesAfter by @laushinka in https://github.com/gitpod-io/gitpod/pull/12257\n*
    [installer]: remove all podsecuritypolicies by @MrSimonEmms in https://github.com/gitpod-io/gitpod/pull/12173\n*
    Ensure workspace classes do not break selfhosted customers by @Furisto in https://github.com/gitpod-io/gitpod/pull/12261\n*
    [installer] Fix installer test by @Furisto in https://github.com/gitpod-io/gitpod/pull/12270\n*
    [ready-probe-labeler] Refactor timeout handling by @aledbf in https://github.com/gitpod-io/gitpod/pull/12272\n*
    [loadgen] add support for passing feature flags by @sagor999 in https://github.com/gitpod-io/gitpod/pull/12239\n*
    ws-manager: Replace initializerMapLock with sync.Map by @utam0k in https://github.com/gitpod-io/gitpod/pull/12215\n*
    [installer]: add golden files for aws, azure and gcp by @MrSimonEmms in https://github.com/gitpod-io/gitpod/pull/12267\n*
    Update docker-compose to v2.10.0 by @aledbf in https://github.com/gitpod-io/gitpod/pull/12280\n*
    ws-manager: Consistently use clearInitializerFromMap. by @utam0k in https://github.com/gitpod-io/gitpod/pull/12286\n*
    [kots]: give installer same node affinity as ws-daemon by @MrSimonEmms in https://github.com/gitpod-io/gitpod/pull/12227\n*
    [changelog] updated changelog by @roboquat in https://github.com/gitpod-io/gitpod/pull/12285\n*
    Update k8s dependencies to v0.24.3 by @aledbf in https://github.com/gitpod-io/gitpod/pull/11177\n*
    [installer] Fix golden files by @aledbf in https://github.com/gitpod-io/gitpod/pull/12299\n*
    [usage] Add Go definition for d_b_cost_center by @laushinka in https://github.com/gitpod-io/gitpod/pull/12298\n*
    Use `toLocaleString` with usage of credits by @filiptronicek in https://github.com/gitpod-io/gitpod/pull/12236\n*
    regenerate usage-api by @AlexTugarev in https://github.com/gitpod-io/gitpod/pull/12294\n*
    [jb] Use the default Java SDK version when there's no explicit configuration for
    it yet by @felladrin in https://github.com/gitpod-io/gitpod/pull/12163\n* Add
    ide-metrics http endpoint by @iQQBot in https://github.com/gitpod-io/gitpod/pull/12271\n*
    [terraform] Make AWS certificate manager optional by @nandajavarma in https://github.com/gitpod-io/gitpod/pull/12253\n*
    Update loadgen readme by @jenting in https://github.com/gitpod-io/gitpod/pull/12289\n*
    Update buildkit to v0.10.4 by @aledbf in https://github.com/gitpod-io/gitpod/pull/12281\n*
    [billing] Add report_id to UpdateInvoices RPC by @easyCZ in https://github.com/gitpod-io/gitpod/pull/12308\n*
    [dashboard] Clarify that spending limit is in credits by @jankeromnes in https://github.com/gitpod-io/gitpod/pull/12291\n*
    [dashboard] Clarify that spending limit is in credits 2/2 by @jankeromnes in https://github.com/gitpod-io/gitpod/pull/12312\n*
    add support for aborting workspaces by @sagor999 in https://github.com/gitpod-io/gitpod/pull/12284\n*
    [alerts] increase GitpodWorkspaceStuckOnStopping for time to 30min to reduce flakiness
    by @sagor999 in https://github.com/gitpod-io/gitpod/pull/12316\n* Revert \"[installer]:
    remove all podsecuritypolicies\" by @MrSimonEmms in https://github.com/gitpod-io/gitpod/pull/12313\n*
    remove trace from retryifUnavailable by @sagor999 in https://github.com/gitpod-io/gitpod/pull/12322\n*
    Update leeway and dazzle by @aledbf in https://github.com/gitpod-io/gitpod/pull/12317\n*
    [ws-manager] add additional logging into finalizeWorkspaceContent by @sagor999
    in https://github.com/gitpod-io/gitpod/pull/12320\n* replace os.IsNotExist with
    errors.Is(err, fs.ErrNotExist) by @sagor999 in https://github.com/gitpod-io/gitpod/pull/12324\n*
    Update leeway to fix regression by @aledbf in https://github.com/gitpod-io/gitpod/pull/12325\n*
    [ide-metrics] allow dynamic labels for metrics by @mustard-mh in https://github.com/gitpod-io/gitpod/pull/12303\n*
    [usage] Add report_id to ReconcileUsage response proto by @easyCZ in https://github.com/gitpod-io/gitpod/pull/12333\n*
    [usage] Return report_id from ReconcileUsage RPC by @easyCZ in https://github.com/gitpod-io/gitpod/pull/12334\n*
    [usage] Proto changes for GetCostCenter RPC by @laushinka in https://github.com/gitpod-io/gitpod/pull/12337\n*
    [ssh-gateway] support rsa sha256/sha512 algorithm by @iQQBot in https://github.com/gitpod-io/gitpod/pull/12288\n*
    [dashboard] Clean up old unused images by @jankeromnes in https://github.com/gitpod-io/gitpod/pull/12307\n*
    [ws-daemon] Prevent divide by zero error by @Furisto in https://github.com/gitpod-io/gitpod/pull/12315\n*
    [installer]: conditionally remove pod security policies by @MrSimonEmms in https://github.com/gitpod-io/gitpod/pull/12336\n*
    Limit connections by @Furisto in https://github.com/gitpod-io/gitpod/pull/11255\n*
    [installer] Fix render tests by @Furisto in https://github.com/gitpod-io/gitpod/pull/12344\n*
    [changelog] updated changelog by @roboquat in https://github.com/gitpod-io/gitpod/pull/12326\n*
    [installer]: show deprecation warning if using podsecuritypolicies by @MrSimonEmms
    in https://github.com/gitpod-io/gitpod/pull/12340\n* [loadgen] Use a variety of
    workspace classes by @Furisto in https://github.com/gitpod-io/gitpod/pull/12342\n*
    [ws-daemon] Check if the shiftfs module already exists by @aledbf in https://github.com/gitpod-io/gitpod/pull/12352\n*
    [ws-manager] improve tracing in initializeWorkspaceContent by @sagor999 in https://github.com/gitpod-io/gitpod/pull/12361\n*
    [ws-daemon] when WaitForInit ensure that state is indeed ready by @sagor999 in
    https://github.com/gitpod-io/gitpod/pull/12360\n* [licensor] Fix lint issue S1023
    by @aledbf in https://github.com/gitpod-io/gitpod/pull/12363\n\n## New Contributors\n*
    @shannonkinney95 made their first contribution in https://github.com/gitpod-io/gitpod/pull/11819\n*
    @AMetIR made their first contribution in https://github.com/gitpod-io/gitpod/pull/11548\n\n**Full
    Changelog**: https://github.com/gitpod-io/gitpod/compare/2022.07.1...2022.08.0-rc0"
  sequence: "10"
  version: 2022.8.0
kind: ConfigMap
metadata:
  annotations:
    kots.io/app-slug: gitpod
  labels:
    app: gitpod
    component: gitpod-installer
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: gitpod-installation
---
apiVersion: v1
data:
  .dockerconfigjson: eyJhdXRocyI6eyJwcm94eS5yZXBsaWNhdGVkLmNvbSI6eyJhdXRoIjoiTWpjelYxcGxObnBJUldOV1NFZFBkVWxCZG1sMWVVZFlZbWR0T2pJM00xZGFaVFo2U0VWalZraEhUM1ZKUVhacGRYbEhXR0puYlE9PSJ9LCJyZWdpc3RyeS5yZXBsaWNhdGVkLmNvbSI6eyJhdXRoIjoiTWpjelYxcGxObnBJUldOV1NFZFBkVWxCZG1sMWVVZFlZbWR0T2pJM00xZGFaVFo2U0VWalZraEhUM1ZKUVhacGRYbEhXR0puYlE9PSJ9fX0=
kind: Secret
metadata:
  annotations:
    helm.sh/hook: pre-install,pre-upgrade
    helm.sh/hook-weight: "-9999"
    kots.io/app-slug: gitpod
  creationTimestamp: null
  labels:
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: gitpod-registry
  namespace: gitpod
type: kubernetes.io/dockerconfigjson
---
apiVersion: v1
data:
  .dockerconfigjson: eyJhdXRocyI6eyJwcm94eS5yZXBsaWNhdGVkLmNvbSI6eyJhdXRoIjoiTWpjelYxcGxObnBJUldOV1NFZFBkVWxCZG1sMWVVZFlZbWR0T2pJM00xZGFaVFo2U0VWalZraEhUM1ZKUVhacGRYbEhXR0puYlE9PSJ9LCJyZWdpc3RyeS5yZXBsaWNhdGVkLmNvbSI6eyJhdXRoIjoiTWpjelYxcGxObnBJUldOV1NFZFBkVWxCZG1sMWVVZFlZbWR0T2pJM00xZGFaVFo2U0VWalZraEhUM1ZKUVhacGRYbEhXR0puYlE9PSJ9fX0=
kind: Secret
metadata:
  annotations:
    helm.sh/hook: pre-install,pre-upgrade
    helm.sh/hook-weight: "-9999"
    kots.io/app-slug: gitpod
  creationTimestamp: null
  labels:
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: kotsadm-replicated-registry
  namespace: gitpod
type: kubernetes.io/dockerconfigjson
---
apiVersion: v1
data:
  s3AccessKey: MDFVMTZTMjNBR1U5QVE0VjJOVzY=
  s3SecretKey: Rk1xbU5xT3ZxNVFBUzRDelFzYUZsbFBPUkRSd2Z0ZFlMUlBxY0cyaQ==
kind: Secret
metadata:
  annotations:
    kots.io/app-slug: gitpod
    kots.io/when: "true"
  labels:
    app: gitpod
    component: gitpod-installer
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: container-registry-s3-backend
---
apiVersion: v1
data:
  encryptionKeys: W3sibmFtZSI6ImdlbmVyYWwiLCJ2ZXJzaW9uIjoxLCJwcmltYXJ5Ijp0cnVlLCJtYXRlcmlhbCI6IjR1R2gxcTh5MkRZcnlKd3JWTUhzMGtXWEpscXZIV1d0L0tKdU5pMDRlZEk9In1d
  host: cHJpdmF0ZS1teXNxbC1kby11c2VyLTk0NDUxMTMtMC5iLmRiLm9uZGlnaXRhbG9jZWFuLmNvbQ==
  password: QVZOU19KNmI1UkV4ZkxicjJ0SDF4WHFy
  port: MjUwNjA=
  username: Z2l0cG9k
kind: Secret
metadata:
  annotations:
    kots.io/app-slug: gitpod
    kots.io/when: "true"
  labels:
    app: gitpod
    component: gitpod-installer
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: database
---
apiVersion: v1
data:
  license: eyJsaWNlbnNlRGF0YSI6ImV5SmhjR2xXWlhKemFXOXVJam9pYTI5MGN5NXBieTkyTVdKbGRHRXhJaXdpYTJsdVpDSTZJa3hwWTJWdWMyVWlMQ0p0WlhSaFpHRjBZU0k2ZXlKdVlXMWxJam9pWTI5dGJYVnVhWFI1SW4wc0luTndaV01pT25zaWJHbGpaVzV6WlVsRUlqb2lNamN6VjFwbE5ucElSV05XU0VkUGRVbEJkbWwxZVVkWVltZHRJaXdpYkdsalpXNXpaVlI1Y0dVaU9pSmpiMjF0ZFc1cGRIa2lMQ0pqZFhOMGIyMWxjazVoYldVaU9pSkRiMjF0ZFc1cGRIa2lMQ0poY0hCVGJIVm5Jam9pWjJsMGNHOWtJaXdpWTJoaGJtNWxiRWxFSWpvaU1qVTVXVmxDU1V4WVZHRXpNRk14VTI5c2FUbFpZMWRqVUZSaUlpd2lZMmhoYm01bGJFNWhiV1VpT2lKVGRHRmliR1VpTENKc2FXTmxibk5sVTJWeGRXVnVZMlVpT2prc0ltVnVaSEJ2YVc1MElqb2lhSFIwY0hNNkx5OXlaWEJzYVdOaGRHVmtMbUZ3Y0NJc0ltVnVkR2wwYkdWdFpXNTBjeUk2ZXlKamRYTjBiMjFsY2tsa0lqcDdJblJwZEd4bElqb2lRM1Z6ZEc5dFpYSWdTVVFpTENKMllXeDFaU0k2SWlJc0luWmhiSFZsVkhsd1pTSTZJbE4wY21sdVp5SjlMQ0prYjIxaGFXNGlPbnNpZEdsMGJHVWlPaUpFYjIxaGFXNGlMQ0oyWVd4MVpTSTZJaUlzSW5aaGJIVmxWSGx3WlNJNklsTjBjbWx1WnlKOUxDSmxlSEJwY21WelgyRjBJanA3SW5ScGRHeGxJam9pUlhod2FYSmhkR2x2YmlJc0ltUmxjMk55YVhCMGFXOXVJam9pVEdsalpXNXpaU0JGZUhCcGNtRjBhVzl1SWl3aWRtRnNkV1VpT2lJaUxDSjJZV3gxWlZSNWNHVWlPaUpUZEhKcGJtY2lmU3dpYkdWMlpXeEpaQ0k2ZXlKMGFYUnNaU0k2SWt4cFkyVnVjMlVnYkdWMlpXd2lMQ0oyWVd4MVpTSTZNU3dpZG1Gc2RXVlVlWEJsSWpvaVNXNTBaV2RsY2lJc0ltbHpTR2xrWkdWdUlqcDBjblZsZlN3aWMyVmhkSE1pT25zaWRHbDBiR1VpT2lKVmMyVnlJSE5sWVhSeklpd2lkbUZzZFdVaU9qRXdMQ0oyWVd4MVpWUjVjR1VpT2lKSmJuUmxaMlZ5SW4xOUxDSnBjMGRwZEU5d2MxTjFjSEJ2Y25SbFpDSTZkSEoxWlN3aWFYTkpaR1Z1ZEdsMGVWTmxjblpwWTJWVGRYQndiM0owWldRaU9uUnlkV1VzSW1selUyNWhjSE5vYjNSVGRYQndiM0owWldRaU9uUnlkV1VzSW1selRtVjNTMjkwYzFWcFJXNWhZbXhsWkNJNmRISjFaU3dpYVhOVFpXMTJaWEpTWlhGMWFYSmxaQ0k2ZEhKMVpYMTkiLCJpbm5lclNpZ25hdHVyZSI6ImV5SnNhV05sYm5ObFUybG5ibUYwZFhKbElqb2lZbkZ5ZDBkWlV6UlZibUZWZUZWaldUTklRbXM0T0hFMFFsbFphRXhFWWxSbVNHTlFPVzlaYTBkQlVHaDNkVWRGYVdvd2RHUXdiRWcwVEhvek9WWmtlVzQ0TjJZemMyWXdkbTlLSzNVd2FtaE5hell4T0hOak1XMWtVRmQzTlZsMFVtZHFaamtyZG1oeFVuaDZaMkV6UzJ4T1ZqRjBTM05ZZW5SSWVGWXJiM05OUW5wcWJ6UkZablJpTlRJcmVXaHpkVVZvWmtkR1VYTjVXWEJ0ZEhOdWVUZEhSbGc1U1RsTVFsb3JNek5NTUd0Q04xcG9XRWh1T1VWclFuazRkeXRyWTNOcGFIUlFZbGswU2k5Vk9WSmpjQ3RtVG1jMlYxRjZiWHBhT1dndlkzTXdkbEp0VFdSd1NtTmpTMHROTTFCbVpGWlVlalpuWVZaVWJtc3ZaSEZhT1dJeWFrUmFWM1F2UTBkSVEyaHVaVTFOWWt0V1QwMUxaRXMxTVcxeFVuTndjV0ZaWVc1amMwbEpjV0UzUlZOdFFsTlRTM04zWjFvNVZrTjBVemx1U20xTlpGZG1hM2xMTm1WbVdtYzRhMFJMZDBWQlJEWjNQVDBpTENKd2RXSnNhV05MWlhraU9pSXRMUzB0TFVKRlIwbE9JRkJWUWt4SlF5QkxSVmt0TFMwdExWeHVUVWxKUWtscVFVNUNaMnR4YUd0cFJ6bDNNRUpCVVVWR1FVRlBRMEZST0VGTlNVbENRMmRMUTBGUlJVRnZOVzU2T1ZsRVMxTlJSbVZ3YjJKYVZqQTVkMXh1V0V0bE4zUnNURlZWVlc1VFpUZ3dNRWREUzFSRFZGcHpibTlxZFVKaGVXcHBTMlIzV2tRelZWUktjVEJFYVc5QmNsaFZhMmhFTkd0bWRETnRSRlEzUmx4dVlrRnllRmRFVlhSck4xZHpWakZtYkVodmNHdGlXRnBJY0VoeVQzZDJXR1pUUWtoaU9WRkJhVWswZDFwRGRtbENaamRPTUhWbFRXbG9VREprYTNCc2JWeHVObVpJTHpGVGJHcGtaVlZTTVdWSmNtVldOMlJEUVhCaWFXNXlOazlVU0RGalUwNDFWbU5aZUhOMlVqaFVPVGdyVVVsSEwwWldhbU0zYTNOclNtSnlNMXh1ZDBKVGRHaGpVbGhLYmt0dFprb3plV1Z4ZDJkbE5rRkJRMmRuVjFaUVREUkdhblpvTkM5Uk1uUnhXa2RDY1d4UFdYVjRMelJJVjNaVFUyVllTMWgyY2x4dVlVUmFja05uU1hGT01YQlJSVmt3YW0weVpreEhaRTlEUldoRmRsUnhaRTQwZFc5bmJFMDFjaXN5ZFVsWWJuVkVhRW92UTNaTGRHZFRSV1pJTTNCa2RWeHVjbEZKUkVGUlFVSmNiaTB0TFMwdFJVNUVJRkJWUWt4SlF5QkxSVmt0TFMwdExWeHVJaXdpYTJWNVUybG5ibUYwZFhKbElqb2laWGxLZW1GWFpIVlpXRkl4WTIxVmFVOXBTbk5XTTFaTVpFWkdNRTVWVG5oaU0xa3hVa1pvVEZOclNYZGhla1paVVd4S2JGTXhjRFpWZW1NeVZFWnZNVk51U2paT1NIQm9WVEZyZUZJd1pIaE9hMDVGV1ZaU1EwNXJTbTFOUnpFeVZqTmFiMDFVVWxKaFZsWjFUVlYwZDFrd1NuaGhWR1J0VlhrNU1rNURPWEJoYkhCdVdsVTFkMDB6YUVKa2JXUk5WREJvVjA1Rk5VNVdWVFZRVTFka1lXUXdSWFpqVlVaTFZWVm9VMHN3TlhWU1ZFMTJZMVZaTlZRemIzaFhVemd6VjIwMWIwMURPVkZPVnpWMllXazVTMkpJWkVoTldIQnNWR3BLUmxSV1FrNVRWemxwVkRKS1lWWXhVbEpqUlZVell6QmplRTVXUWtSVWJsSk9UV3BvYWs5SFRUUlhWbEp6VXpOYVRHTklSakJoTVZwNFZWVnNhRTlVYURCYVZHd3lVM3BzVG1GWVNsSmtiRkl5V2taT1ZHTXhiSEpoYTBaUVltMTBRMVZzVW10a1JHUlFZMWRWZWxkdGRHdFhSMXB3VTJwa1FtSXhXbmxYVlU1T1pVWlZlVll5VmtsVmVYTjZWVE5PWVZkdE1VUmFNbmhvVVROa2FHSXdSVEpTVjBveVVUQjRWVTVFYUdGaVYyaEtaVzVhUms0d09VdFRNREUwVWtWYWFrMHlUalZoTW5OMlYxTnplRkpVYUcxTk1GWmFVMVJyTVZWWWFEVlVhMW93VjBaYVdsUlZPVVJNTVdOM1RqQnNhbFpHV1hka1JYQnBVbTB3TUUxR1JUbFFVMGx6U1cxa2MySXlTbWhpUlhSc1pWVnNhMGxxYjJsWmJWSnNXbFJWTWs1VVdYZFpNbHBwVGtST2FrOVhTWGxQUjBwdFQxUm9iRmxYVG1oYWJVVXlUa1JaYVdaUlBUMGlmUT09In0=
  type: cmVwbGljYXRlZA==
kind: Secret
metadata:
  annotations:
    kots.io/app-slug: gitpod
  labels:
    app: gitpod
    component: gitpod-installer
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: gitpod-license
---
apiVersion: v1
data:
  release: SDRzSUFBQUFBQUFDLytRN0RXL2JPSlovUmVBaG1KbXU3ZmdyY2F6RFlkR216YlNZdERYaXRJdTlPbWRRMUpQTkRVVUtKT1hFbS9OL1A1RFVweTNiU2FkN3dGMVJvRENmeVBmRngvZEY1Z2x4SEFQeVVjUlM0TG9kVUkxYWlQSklJUDhKUlZRcVBROGhZV0lOSWZJUmFpR0dkMEFoTU5EbFFCRkpFMDBGUno1Nks5ZWVUTGxIUkp5WVNhaUZsTVk2VmNoSEJaSk5DNUVsbHRxUWpFSGpFR3RzZmpleHRnS3BIT3B1cDkvdDlIY28vazUxSWtLdnRnZ245R3V4YnVYV0pNQkQ0SVNDUXY2M1o5T1NrQWhGdFpCcjVLT2wxb255VDAvZG9zNkM2bVVhZEtnNFhRS0wyMVlraFZvSU9BNllVWStXS1d6dU5pM0VCTGszQWk2QWc4Uk9kZjF1djkvdVhyVDc1N2U5bnQ4ZCtjTng1Mkl3NkhWSDNmUFJmeHFXNlFLVVJqNVNTOXcvTy9jSHcxRjBjWWFEOEt3ZmpydDRNQmhGQlByUitHeHdmaFppY3RhTFJwZ01vaERER0lhRFFTOFl3SGc4R0hTRC9uQTR1T2ozL2xlMVlNWFdFQ2NNYTBPTHA0eTEwQXF6MUl5ZXFoVDlKNFNqaUhLcTE4aC8yclFRNWx4b2JMWlhaUUM1TU96ZXRSQk90VkFFTThvWFpsMEFTN3lpUXJwcEpGVmF4RGNwZzJ4MnNSRVJaZ3BhS01hUE41QXdTckJDL3FDRllzckxjYStGTkpZTDBKZVRMMTgwWmZTZmxvVUpTQUpjNHdVZ2YzUm1xSWc0eGp4MEZJamdFYldzT09JVExCVklZK3pmSnE5dnB1OXU3bWJjOHp6dkU0N0JDd1c1QnpubllxNXBETzdEbFpBeDF0NC9sT0FPY0V0am1QOEJrSGlmbzZnR1dudmxNZ3ZLMXA3OHZYMFN0MC9DMjVQMy9zbEgvMlRhT2JtZWNXT0hqMXJpSzJyVllmUVRVYVl6NXE0K1hOL1dtYnRQQTVBY05DZ0gvSWcxV1ZwbzUxVUdBYm1BK2JWWWVKOHpYZzJiRHBDeitzZkZ0SDB0Rmd2S0Z4Mm5pM0p5NWRPN1I4TFNFT3czNjM2U1ZGdStQbnlhZkxtdHNxVXhaVzQ0d1hycG5hNndQR1ZpY1VvRTE1aHlrT3IwVlllSmhac1RwOHpzSElkTzRvZzdsYmM4SW1tbU9MellFaXFldjBtaitUV05xZmJPUHI1eDRPazlOWkx4eGZ5YWNsQ1cwUm5mWlUrdGxZWTRMSEV2aGRJNTdxbjdPTCt5ZXZmbTA3OVBiOTk5ZkR2Lzh1bkQ3WDhZSmhqb2pnSzVvaVRiMWh2QTRmeEtpbmgraXluTDFTTlNuZXZuODVmYkxRNzI3OWQ3b2JRSHhuMVRvZ0JMc216SFdHbVE3dk8xV0NpTjFUSTNvM3lmYmtETGRhYVBLM051ck9USENGZmwvazdDQlh3aUlhS1BIaGNoN0dYSnhCV25PYU9XNmJ1YnJ4OHUzMlhzdmNVUUMxNGE1UlZMMWRKN2V2STZYNjMvNlVRV3NOa1VkT2ZYc0FKV25jTEV3c0h5V2RuSk5wc0puck11MVRISHYrR3o4d1h6M1ZudmIyOG44eW5JVmVWY1dOZzFWUnE0MSszWWY1VVBFeUYxbGE4WXRLUkVXWERPMm52QVRDL25sMHNnOTg1bU5pMFVXaVZNUVg4VkxJM2hvMGk1ZGo0L05qL05hVUkreXM4VGF1V2hZSVdsR1c5YVRSTnBjT3BPVk9YODFaZlN3RTJvZlplQXc4K2NyYk9JdUkwYU5EbU5NVmxTRG0wYWx2aEFrd3hzb1Z0WTduWmtkT0laUzNTWW4xQ3lKZVdtU2N5OUN4cWwzUndUZHgvS0hTbjFPakZvak1WVXNOYUVka0txWlNDd0RHM2MzSW1OMnpHTzRRRFlIMkFDOVVMaUNITThMekJrcWxVSnRzZkdtZ2xYbDNrTWM4T0pZSlNZNVpjc05ZZjJ5dVNFTnF0WjVWRjFaVnhVTWZnYjFjdmJoR1hqUjZvMDVRdUg5Q05PWEpKb1E5RmxxYVJzcnBiWVdISjF2R1d1ZFhBR3NlZlhSdXdvWmN5STlIa0ZVdElRSExVRkV3Rm1UaUt6RmE4WnhTcGZiQUNmUUQ4SWVWOG9qY1kydmoraEpHV3NVTUJyOW9EWGFqdjlJYkxqa3BlQWFwUDF1TUZwTFlYU2VKSHAxMktlcEl4TmdVaklSYUo4SVVFMWJ5aGhXS2xQemhqUTd2NWFiUmdQV3hFbis2bVovV0dvY3FxM3RYMVBUZEtDM3VabkJtVzJrcEZsTkFLeUpnenk0UW80S0RXUklyQ2FNVm5mNzZDckZvMWFLQkVtaTdjZjBjWW11czV0SXQvVkZDM0VVankxMlhwR3ArTEFrTi92OXJ2T0p1c2J5TjMrNUR2eHRLVUZjMXBFQ0ZOZ1FIU2UvWWtFK0hSSkk3MDczOFFLa2txcTEwWXA4R2gwbzdURTFOcFkweDVJd0JveVI3TXhZb2F2dCtja0lueExsVXh0SGZJbURSZE9PVWNQYUl3ZnYzQzh3cFFaT1BMUm9IdUNITDdyeW40a0lweldtZDZCbCtyWkswQ3Vya1JTWVZIVmpTdVJJZ2E5aEZTWnJMbFIwVExBeE9hM0ZaVTQ5YjhteE5wd01STndTSS9aREU3bzZhcDN1clFocThHQXBNdkhMODM1dHlkY2doS3BKSGtPcTVwMFVtUUNEWnBnTloyV1JwZDUzOHpKZlppZ0VzOXJRaHo1WTVaUnJQZ29PSFdHdUt0QURVcGZTUnlEOHpoUEwzSTJRYXJXZ1hnc1hJcXRwclRWbEJiTTFKS09OWFBBMHlURUdxYmFGSmlMckpSYUhReitwYyt5MGFrYzJwU2xETVJabGROQ0tnMnl0ZHR6ZDRMNkZ1NkdsT2dnL3FiNW16c2p0eUpMaUhGZVVVYXV2REdEVGJVY3E5ZVhGZmloR2tqcFVLVDZ4NVlrazJvaFV0WUpzN1RiSFpCRWhIT2pBenVDamdNV2VDcWZpb1h6RzFqQW8vZnJYNXNRZk1QdGYzYmI0N3RmdjdXelg2OXkwRzkvL1hVMjZ4eWM4TnVyMytZNTNpSk5xR0wvci9uZFg4b3BUV3gyL3ZKYmUzOEJkYXlVTVh0WnJTbnNRUWxTeXNLOFdMc1BxZlRNMGF2cWYyRWJRR1lMMmtRd0Z4SnF4WFhDTU9WN3FwZ2RtbHhwekJqSUgwVHkzN3kvQ1hsdlZhbWV4Y0NEZXRWNXlKZjhDQjZNWTl0TnY1N3lwZ3A2V0pxU3hXRC9keThVSHBDbDhHYm9BVk9UeHMyUXRkVCt1ZnZmVXd3ZzhjNjdaaW9IZEZkdGh5QmxISHFiR0dqbTQzTC81ZmZLdzM0dmJKUHNzR2R5d2xVOVJDWmhReDJ3MlpNNlBodmxaamZKYkU3aEN4Ulo4SGhMcGNXdy9pd3ZYVnpZN0VGZlJDR0VFNU1TRjVpSWlCUEJ3VVNiRE5pdTdlaDJadkR5OWNabnhwalR5RFVUMisyMnNjcXBEYXArcFcxNjZqcDNWY2RkOU85T3N6aUhYV1RzckhITVpyenNzdnJlcWpmakpzUDB2V2t0aU01NDN1RDFqWEVhNVZTSkdwalRqZTlzZHdrczdxaWxZNlk2cysyYWtXNFdUcEpPMmJBeVdYZ1Q0cVo1OW54ejhxeTVxMXk0R2VwMXhwM2hETzJiR1dPT0Z4QzJnN1h2dlFjV3ovajNxZG5GcVJnbkJ6VmMxRlkvcTNJTGlSdXlCTi83YjRlbzNvQTkySVJ0Yk1UdWFjYnVhY2crcnlsclpwbi90N0tua3VkNkk2dXBtVlUydEhvbG9HeGhtYXFyaEI5cFdqMi9jYld2ZVhXd2dWVnZZcG0wdXdMZjdsbmxxdkc4V3NiVmtIVTlOL1BhazMzOXFRenMvMWdXdGk4VHF5aTdsZ1h2Wk1LVmliWFVwU0Y5T1pDM05TVXh6MGxrZHBPWjcrTm5LNmY3VjdCVHovTmV5R0JEenZmamVQek9TT1RxWWlrWU5NUWlHV0RTd2FsZUNwbGRrM1h1TDV4Ykw2T1V3M0Fqakx3L1o1eVNLUU1uVTl2RENmMWRpalRKWlRTd0djcXhGVjJPeXRmaTlLc1Nsb2d3RzYxQUJ0WFpDOURsZ0ZGVkdUMFlJL3NCaGhCUUhsSysrUFAyOE1ZaCttbk5RakM0Z2NoS2xadkZBUjJhYVExSHFrbGhLZzMrQVVUbk50ZWNrQnMybTFWU1dKenZTVWpZMDVOMVdSYXkyWHl2QVdXbHczTnFocC9WSUZRQ3hJcGs2c3BpbXo5TURDZ1JVdWZ5dHUzSXI2VlM3czNDeE1LWFdpYzVQSkZDQ3lLWTc5MWVUbktnRXp5ZnByTCt1Zit2MGRQM21ZdTcwMVBRVkdUaUpGRVZqMUpjWmZ5c2RwUE44ejJYRHpoQTBSSEl3ZTJ0TktHd3RxMzlqMDJZdUs3cTZmazZlSWtXOHIzT3lWYTN6bUlxZSs1K21kUVFVeW1vTk01cVpOOGI0SDU0UHJyb2RpTWNrSXR1ZHp6cWs4R2dGNXlIUGVpZEFZekdPT3AyUjJmREtBcHhHSTZpcUJlTm8vTnVMK29HbzFFM2JFRE5VdXhlbGluZmcwSFFKY05oZjN3UmtSN3BEY2M0Q3FJaHVSaVB6Nk5nM0IvMlJ4aUdQUmllRDhmQmVEQWtlRGcrRzQ5N3dlamlyQjljbkozbDZGbGRvUzlSNmN0TXE5RVlubVVRWmxKaEZIWlFpeGlmOXJCWHVVajF2Y2c5eTNCZmlsdmt3cGZaUytUOGMxbXVWZFRTOXZhcndYTWxoVGtqUjI5Zi9kb3BxcXllRkxjdHZ1Y3VXNnBUcW01Mm02V3FXeTJWbXNrdzJmSElCY29tRDJ4Tm9ucTN1a1V6dXpMemQ1Qmh2ZlM5MHgzd2p0OTMyV1QxSnU1bEZHb1hkTThqVjIzbDdxaXc2TUg2M3BIN3BtMWlUdm51dUc5L3l5NktmTzhnam9QVUQvWTZYc0RCVVR4MUxyS2VSVE1wOXlybDZQS21oeW43RWU2K1VkbWVtM2ZVL2ExaWM1ZDgvUkZMTTgzcUM1YnZwN1R0eGVvN3NsUHp0ajBzRjNYcmEzdC80bXFqaWlpNzR0aENycGIxY1pzME9LemkvcVA2elFseEw3UjYxaWs2cnBlOVd0bXZja2V0eVFIdm1qdkorODErRTlrbWg5MzI4dXVUclNYSjNrUFFmQUNlaGVqWWNYamVVVGhHNnBEcHU3ejlxdGJhT1h3Y2psRnIybVpIWmVmU2FaZGt4UkpRQ3kyRnVOL3oycnV0UWVrMkVad0RzYy9waTJkQ0UzdTdsR3hmOWg5TTNRMHk5MzhGcFUzalVlMEtxcmtHbkJoeEcvTDQyUUYrWFpqL2Y1cmI3K2JCTTVSTFovWjBobnpQNmtPbDlpVk9KYlBmeWJEeXcvMVFhUk1WT1ZYdXBOemprakoxT3BJMjVXN1IrL2FMUWZ0TDBlbTBudGo3OWtzbEtUUDVrWnNnUVdrc2RZN3lFNnhBb2hhQ0ZiaGJXL3RlQnQxbGYzY2lVNDc4SjJTWFFEakgycjFieXYrNnBJUWtTNnpjbThiTlhlVlBHSHIxRjQvWnRlbm1md0lBQVAvL0VCYmdzQVl6QUFBPQ==
kind: Secret
metadata:
  annotations:
    kots.io/app-slug: gitpod
  creationTimestamp: null
  labels:
    createdAt: "1"
    kots.io/app-slug: gitpod
    kots.io/backup: velero
    name: fluent-bit
    owner: helm
    status: deployed
    version: "1"
  name: sh.helm.release.v1.fluent-bit.v1
type: helm.sh/release.v1
---
apiVersion: v1
data:
  accessKeyId: MDFVMTZTMjNBR1U5QVE0VjJOVzY=
  secretAccessKey: Rk1xbU5xT3ZxNVFBUzRDelFzYUZsbFBPUkRSd2Z0ZFlMUlBxY0cyaQ==
kind: Secret
metadata:
  annotations:
    kots.io/app-slug: gitpod
    kots.io/when: "true"
  labels:
    app: gitpod
    component: gitpod-installer
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: storage-s3
---
apiVersion: v1
kind: Service
metadata:
  annotations:
    kots.io/app-slug: gitpod
  labels:
    app.kubernetes.io/instance: fluent-bit
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: fluent-bit
    app.kubernetes.io/version: 1.9.4
    helm.sh/chart: fluent-bit-0.20.2
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: fluent-bit
spec:
  ports:
  - name: http
    port: 2020
    protocol: TCP
    targetPort: http
  selector:
    app.kubernetes.io/instance: fluent-bit
    app.kubernetes.io/name: fluent-bit
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kots.io/app-slug: gitpod
  labels:
    app: gitpod
    component: gitpod-installer-status
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: installation-status
spec:
  replicas: 1
  selector:
    matchLabels:
      app: gitpod
      component: gitpod-installer-status
  strategy:
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
    type: RollingUpdate
  template:
    metadata:
      annotations:
        kots.io/app-slug: gitpod
      labels:
        app: gitpod
        component: gitpod-installer-status
        kots.io/app-slug: gitpod
        kots.io/backup: velero
    spec:
      containers:
      - args:
        - |
          set -e

          while true
          do
            echo "Checking installation status"

            if [ "$(helm status -n gitpod gitpod -o json | jq '.info.status == "deployed"')" != "true" ];
            then
              echo "Gitpod: Installation not complete"
              exit 1
            fi

            echo "Sleeping for 10 seconds"
            sleep 10
          done
        command:
        - /bin/sh
        - -c
        image: eu.gcr.io/gitpod-core-dev/build/installer:release-2022.08.0.10
        name: installation-status
        resources:
          limits:
            cpu: 500m
            memory: 128Mi
      imagePullSecrets:
      - name: gitpod-registry
      restartPolicy: Always
      serviceAccountName: installer
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  annotations:
    kots.io/app-slug: gitpod
  labels:
    app: gitpod
    app.kubernetes.io/instance: fluent-bit
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: fluent-bit
    app.kubernetes.io/version: 1.9.4
    component: gitpod-log-collector
    helm.sh/chart: fluent-bit-0.20.2
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: fluent-bit
spec:
  selector:
    matchLabels:
      app.kubernetes.io/instance: fluent-bit
      app.kubernetes.io/name: fluent-bit
  template:
    metadata:
      annotations:
        checksum/config: 3a2d67800fabc800972c331b6d1e15ee79af00754ffdadd7ff1f9f601f0b770d
        checksum/luascripts: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
        kots.io/app-slug: gitpod
      labels:
        app: gitpod
        app.kubernetes.io/instance: fluent-bit
        app.kubernetes.io/name: fluent-bit
        component: gitpod-log-collector
        kots.io/app-slug: gitpod
        kots.io/backup: velero
    spec:
      containers:
      - image: cr.fluentbit.io/fluent/fluent-bit:1.9.4
        imagePullPolicy: Always
        livenessProbe:
          httpGet:
            path: /
            port: http
        name: fluent-bit
        ports:
        - containerPort: 2020
          name: http
          protocol: TCP
        readinessProbe:
          httpGet:
            path: /api/v1/health
            port: http
        volumeMounts:
        - mountPath: /fluent-bit/etc/fluent-bit.conf
          name: config
          subPath: fluent-bit.conf
        - mountPath: /fluent-bit/etc/custom_parsers.conf
          name: config
          subPath: custom_parsers.conf
        - mountPath: /var/log
          name: varlog
        - mountPath: /var/lib/docker/containers
          name: varlibdockercontainers
          readOnly: true
        - mountPath: /etc/machine-id
          name: etcmachineid
          readOnly: true
        - mountPath: /gitpod
          name: collector
      - args:
        - while true; do echo "waiting" && sleep 60; done
        command:
        - sh
        - -c
        image: busybox:1
        name: kots
        volumeMounts:
        - mountPath: /gitpod
          name: collector
          readOnly: true
      dnsPolicy: ClusterFirst
      hostNetwork: false
      imagePullSecrets:
      - name: gitpod-registry
      serviceAccountName: fluent-bit
      volumes:
      - configMap:
          name: fluent-bit
        name: config
      - hostPath:
          path: /var/log
        name: varlog
      - hostPath:
          path: /var/lib/docker/containers
        name: varlibdockercontainers
      - hostPath:
          path: /etc/machine-id
          type: File
        name: etcmachineid
      - hostPath:
          path: /gitpod
          type: DirectoryOrCreate
        name: collector
---
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    kots.io/app-slug: gitpod
  labels:
    app: gitpod
    component: gitpod-installer
    cursor: "18"
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: installer-18
spec:
  backoffLimit: 1
  template:
    metadata:
      annotations:
        kots.io/app-slug: gitpod
      labels:
        app: gitpod
        component: gitpod-installer
        cursor: "18"
        kots.io/app-slug: gitpod
        kots.io/backup: velero
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: gitpod.io/workload_workspace_regular
                operator: Exists
            - matchExpressions:
              - key: gitpod.io/workload_workspace_headless
                operator: Exists
      containers:
      - args:
        - |
          set -e

          echo "Gitpod: Killing any in-progress installations"

          kubectl delete jobs.batch -n gitpod -l component=gitpod-installer,cursor!=18 --force --grace-period 0 || true
          kubectl delete pod -n gitpod -l component=gitpod-installer,cursor!=18 --force --grace-period 0 || true

          if [ "$(helm status -n gitpod gitpod -o json | jq '.info.status == "deployed"')" = "false" ];
          then
            echo "Gitpod: Deployment in-progress - clearing"

            VERSION="$(helm status -n gitpod gitpod -o json | jq '.version')"
            if [ "${VERSION}" -le 1 ];
            then
              echo "Gitpod: Uninstall application"
              helm uninstall -n gitpod gitpod --wait || true
            else
              echo "Gitpod: Rolling back application"
              helm rollback -n gitpod gitpod --wait || true
            fi
          fi

          echo "Gitpod: Create a Helm template directory"
          rm -Rf "${GITPOD_OBJECTS}"
          mkdir -p "${GITPOD_OBJECTS}/templates"
          cat <<EOF >> "${GITPOD_OBJECTS}/Chart.yaml"
          apiVersion: v2
          name: gitpod-kots
          description: Always ready-to-code
          version: "1.0.0"
          appVersion: "$(/app/installer version | yq e '.version' -)"
          EOF

          echo "Gitpod: Generate the base Installer config"
          /app/installer init > "${CONFIG_FILE}"

          echo "Gitpod: auto-detecting ShiftFS support on host machine"
          kubectl wait job -n gitpod --for=condition=complete -l component=shiftfs-module-loader --timeout=30s || true
          ENABLE_SHIFTFS=$(kubectl get jobs.batch -n gitpod -l component=shiftfs-module-loader -o jsonpath='{.items[0].status.succeeded}')

          if [ "${ENABLE_SHIFTFS}" = "1" ]; then
            echo "Gitpod: enabling ShiftFS support"

            yq e -i '.workspace.runtime.fsShiftMethod = "shiftfs"' "${CONFIG_FILE}"
          fi

          echo "Gitpod: auto-detecting containerd location on host machine"
          if [ -d "/mnt/node0${CONTAINERD_DIR_K3S}" ]; then
            echo "Gitpod: containerd dir detected as k3s"

            yq e -i ".workspace.runtime.containerdRuntimeDir = \"${CONTAINERD_DIR_K3S}\"" "${CONFIG_FILE}"
          elif [ -d "/mnt/node0${CONTAINERD_DIR_AL}" ]; then
            echo "Gitpod: containerd dir detected as ${CONTAINERD_DIR_AL}"

            yq e -i ".workspace.runtime.containerdRuntimeDir = \"${CONTAINERD_DIR_AL}\"" "${CONFIG_FILE}"
          fi

          if [ -S "/mnt/node0${CONTAINERD_SOCKET_K3S}" ]; then
            echo "Gitpod: containerd socket detected as k3s"

            yq e -i ".workspace.runtime.containerdSocket = \"${CONTAINERD_SOCKET_K3S}\"" "${CONFIG_FILE}"
          elif [ -S "/mnt/node0${CONTAINERD_SOCKET_AL}" ]; then
            echo "Gitpod: containerd socket detected as ${CONTAINERD_SOCKET_AL}"

            yq e -i ".workspace.runtime.containerdSocket = \"${CONTAINERD_SOCKET_AL}\"" "${CONFIG_FILE}"
          fi

          echo "Gitpod: Inject the Replicated variables into the config"
          yq e -i '.domain = "gitpod.vyas-n.com"' "${CONFIG_FILE}"
          yq e -i '.license.kind = "secret"' "${CONFIG_FILE}"
          yq e -i '.license.name = "gitpod-license"' "${CONFIG_FILE}"

          if [ 'false' = "true" ];
          then
            echo "Gitpod: Setting Open VSX Registry URL"
            yq e -i ".openVSX.url = \"\"" "${CONFIG_FILE}"
          fi

          if [ 'false' = "true" ];
          then
            echo "Gitpod: configuring CloudSQLProxy"

            yq e -i ".database.inCluster = false" "${CONFIG_FILE}"
            yq e -i ".database.cloudSQL.instance = \"\"" "${CONFIG_FILE}"
            yq e -i ".database.cloudSQL.serviceAccount.kind = \"secret\"" "${CONFIG_FILE}"
            yq e -i ".database.cloudSQL.serviceAccount.name = \"cloudsql\"" "${CONFIG_FILE}"
          fi

          if [ 'true' = "true" ];
          then
            echo "Gitpod: configuring external database"

            yq e -i ".database.inCluster = false" "${CONFIG_FILE}"
            yq e -i ".database.external.certificate.kind = \"secret\"" "${CONFIG_FILE}"
            yq e -i ".database.external.certificate.name = \"database\"" "${CONFIG_FILE}"
          fi

          if [ 'false' = "true" ];
          then
            echo "Gitpod: configuring mirrored container registry for airgapped installation"

            yq e -i ".repository = \"\"" "${CONFIG_FILE}"
            yq e -i ".imagePullSecrets[0].kind = \"secret\"" "${CONFIG_FILE}"
            yq e -i ".imagePullSecrets[0].name = \"gitpod-registry\"" "${CONFIG_FILE}"
            yq e -i '.dropImageRepo = true' "${CONFIG_FILE}"

            # Add the registry to the server allowlist - keep docker.io in case it's just using the mirrored registry functionality without being airgapped
            yq e -i ".containerRegistry.privateBaseImageAllowList += \"\"" "${CONFIG_FILE}"
            yq e -i ".containerRegistry.privateBaseImageAllowList += \"docker.io\"" "${CONFIG_FILE}"
          fi

          if [ 'false' = "true" ];
          then
            DOCKER_CONFIG=''
            echo "${DOCKER_CONFIG}" | base64 -d  > /tmp/userconfig.json
            # Add the registries to the server allowlist
            yq e -i ".containerRegistry.privateBaseImageAllowList += $(cat /tmp/userconfig.json | jq '.auths' | jq -rc 'keys')" "${CONFIG_FILE}"
            yq e -i ".containerRegistry.privateBaseImageAllowList += \"docker.io\"" "${CONFIG_FILE}"
          fi

          # Output the local registry secret - this is proxy.replicated.com if user hasn't set their own
          echo "eyJhdXRocyI6eyJwcm94eS5yZXBsaWNhdGVkLmNvbSI6eyJhdXRoIjoiTWpjelYxcGxObnBJUldOV1NFZFBkVWxCZG1sMWVVZFlZbWR0T2pJM00xZGFaVFo2U0VWalZraEhUM1ZKUVhacGRYbEhXR0puYlE9PSJ9LCJyZWdpc3RyeS5yZXBsaWNhdGVkLmNvbSI6eyJhdXRoIjoiTWpjelYxcGxObnBJUldOV1NFZFBkVWxCZG1sMWVVZFlZbWR0T2pJM00xZGFaVFo2U0VWalZraEhUM1ZKUVhacGRYbEhXR0puYlE9PSJ9fX0=" | base64 -d > /tmp/kotsregistry.json

          if [ 'false' = "true" ];
          then
            echo "Gitpod: configuring external container registry"

            # Create a container-registry secret merging the external registry and KOTS registry keys
            echo '{"auths": {"": {"username": "", "password": "", "auth": "Og=="}}}' \
              | yq -o=json '.' - \
              > /tmp/gitpodregistry.json

            cat /tmp/kotsregistry.json /tmp/gitpodregistry.json | jq -s '.[0] * .[1]' - - > /tmp/container-registry-secret

            echo "Gitpod: create the container-registry secret"
            kubectl create secret docker-registry container-registry \
              --namespace "gitpod" \
              --from-file=.dockerconfigjson=/tmp/container-registry-secret \
              -o yaml --dry-run=client >  "${GITPOD_OBJECTS}/templates/gitpod.yaml"

            yq e -i ".containerRegistry.inCluster = false" "${CONFIG_FILE}"
            yq e -i ".containerRegistry.external.url = \"\"" "${CONFIG_FILE}"
            yq e -i ".containerRegistry.external.certificate.kind = \"secret\"" "${CONFIG_FILE}"
            yq e -i ".containerRegistry.external.certificate.name = \"container-registry\"" "${CONFIG_FILE}"
          else
            if [ 'true' = "true" ];
            then
              echo "Gitpod: configuring container registry S3 backend"

              yq e -i ".containerRegistry.s3storage.region = \"us-west-1\"" "${CONFIG_FILE}"
              yq e -i ".containerRegistry.s3storage.endpoint = \"s3.us-west-1.wasabisys.com\"" "${CONFIG_FILE}"
              yq e -i ".containerRegistry.s3storage.bucket = \"containerregistry.gitpod.vyas-n.com\"" "${CONFIG_FILE}"
              yq e -i ".containerRegistry.s3storage.certificate.kind = \"secret\"" "${CONFIG_FILE}"
              yq e -i ".containerRegistry.s3storage.certificate.name = \"container-registry-s3-backend\"" "${CONFIG_FILE}"
            fi
          fi

          if [ 'true' = "true" ];
          then
            echo "Gitpod: configuring the storage"

            yq e -i ".metadata.region = \"us-west-1\"" "${CONFIG_FILE}"
            yq e -i ".objectStorage.inCluster = false" "${CONFIG_FILE}"

            if [ 'false' = "true" ];
            then
              echo "Gitpod: configuring storage for Azure"

              yq e -i ".objectStorage.azure.credentials.kind = \"secret\"" "${CONFIG_FILE}"
              yq e -i ".objectStorage.azure.credentials.name = \"storage-azure\"" "${CONFIG_FILE}"
            fi

            if [ 'false' = "true" ];
            then
              echo "Gitpod: configuring storage for GCP"

              yq e -i ".objectStorage.cloudStorage.project = \"\"" "${CONFIG_FILE}"
              yq e -i ".objectStorage.cloudStorage.serviceAccount.kind = \"secret\"" "${CONFIG_FILE}"
              yq e -i ".objectStorage.cloudStorage.serviceAccount.name = \"storage-gcp\"" "${CONFIG_FILE}"
            fi

            if [ 'true' = "true" ];
            then
              echo "Gitpod: configuring storage for S3"

              yq e -i ".objectStorage.s3.endpoint = \"s3.us-west-1.wasabisys.com\"" "${CONFIG_FILE}"
              yq e -i ".objectStorage.s3.bucket = \"gitpod.vyas-n.com\"" "${CONFIG_FILE}"
              yq e -i ".objectStorage.s3.credentials.kind = \"secret\"" "${CONFIG_FILE}"
              yq e -i ".objectStorage.s3.credentials.name = \"storage-s3\"" "${CONFIG_FILE}"
            fi
          fi

          if [ 'true' = "true" ];
          then
            echo "Gitpod: Generate SSH host key"
            ssh-keygen -t rsa -q -N "" -f host.key
            kubectl create secret generic ssh-gateway-host-key --from-file=host.key -n gitpod || echo "SSH Gateway Host Key secret has not been created. Does it exist already?"
            yq e -i '.sshGatewayHostKey.kind = "secret"' "${CONFIG_FILE}"
            yq e -i '.sshGatewayHostKey.name = "ssh-gateway-host-key"' "${CONFIG_FILE}"
          fi

          if [ 'false' = "true" ];
          then
            echo "Gitpod: Generating a self-signed certificate with the internal CA"
            yq e -i '.customCACert.kind = "secret"' "${CONFIG_FILE}"
            yq e -i '.customCACert.name = "ca-issuer-ca"' "${CONFIG_FILE}"
          elif [ 'false' = "true" ];
          then
            echo "Gitpod: Setting CA to be used for certificate"
            yq e -i '.customCACert.kind = "secret"' "${CONFIG_FILE}"
            yq e -i '.customCACert.name = "ca-certificate"' "${CONFIG_FILE}"
          fi

          if [ 'true' = "true" ];
          then
            echo "Gitpod: Adding blockNewUsers to config"
            yq e -i '.blockNewUsers.enabled = true' "${CONFIG_FILE}"

            for domain in wasabi.com
            do
              echo "Gitpod: Adding domain \"${domain}\" to blockNewUsers config"
              yq e -i ".blockNewUsers.passlist += \"${domain}\"" "${CONFIG_FILE}"
            done
          fi

          if [ 'false' = "true" ];
          then
            echo "Gitpod: Applying advanced configuration"

            if [ 'false' = "true" ];
            then
              # Empty string defaults to LoadBalancer. This maintains backwards compatibility with the deprecated experimental value
              echo "Gitpod: Applying Proxy service type"
              yq e -i ".components.proxy.service.serviceType = \"\"" "${CONFIG_FILE}"
            fi

            if [ 'false' = "true" ];
            then
              CUSTOMIZATION=''
              echo "Gitpod: Applying customization patch ${CUSTOMIZATION}"

              # Apply the customization property - if something else is set, this will be ignored
              yq e -i ".customization = $(echo "${CUSTOMIZATION}" | base64 -d | yq e -o json '.customization' - | jq -rc) // []" "${CONFIG_FILE}"

              # Delete any old resources
              echo "Gitpod: Deleting old Gitpod resources"
              kubectl delete all -n gitpod -l app=gitpod,component!=gitpod-installer,component!=gitpod-installer-status --wait || true
            fi
          else
            echo "Gitpod: No advanced configuration applied"
          fi

          echo "Gitpod: Update platform telemetry value"
          yq eval-all --inplace '.experimental.telemetry.data.platform = "digitalOcean"' "${CONFIG_FILE}"

          echo "Gitpod: Patch Gitpod config"
          base64 -d "${CONFIG_PATCH_FILE}" > /tmp/patch.yaml
          config_patch=$(cat /tmp/patch.yaml)
          echo "Gitpod: ${CONFIG_PATCH_FILE}=${config_patch}"
          yq eval-all --inplace 'select(fileIndex == 0) * select(fileIndex == 1)' "${CONFIG_FILE}" /tmp/patch.yaml

          echo "Gitpod: Generate the Kubernetes objects"
          config=$(cat "${CONFIG_FILE}")
          echo "Gitpod: ${CONFIG_FILE}=${config}"

          echo "Gitpod: render Kubernetes manifests"
          /app/installer render -c "${CONFIG_FILE}" --namespace gitpod --use-experimental-config >> "${GITPOD_OBJECTS}/templates/gitpod.yaml"

          if [ 'true' = "true" ];
          then
            echo "Gitpod: Add the local registry secret to the in-cluster registry secret"

            # Get the in-cluster registry secret
            yq eval-all '(select(.kind == "Secret" and .metadata.name == "builtin-registry-auth") | .data.".dockerconfigjson")' \
              "${GITPOD_OBJECTS}/templates/gitpod.yaml" \
              | base64 -d \
              > /tmp/gitpodregistry.json

            export REGISTRY_SECRET=$(cat /tmp/kotsregistry.json /tmp/gitpodregistry.json | jq -s '.[0] * .[1]' - - | base64 -w 0)

            echo "Gitpod: update the in-cluster registry secret"
            yq eval-all --inplace '(select(.kind == "Secret" and .metadata.name == "builtin-registry-auth") | .data.".dockerconfigjson") |= env(REGISTRY_SECRET)' \
              "${GITPOD_OBJECTS}/templates/gitpod.yaml"
          fi

          # figure out the secret to use
          if [ 'false' = "true" ];
          then
            export REGISTRY_SECRET_NAME="container-registry"
          else
            export REGISTRY_SECRET_NAME="builtin-registry-auth"
          fi

          if [ 'false' = "true" ];
          then
            echo "Gitpod: Add given extra docker config json file to ${REGISTRY_SECRET_NAME}"

            yq eval-all '(select(.kind == "Secret" and .metadata.name == env(REGISTRY_SECRET_NAME)) | .data.".dockerconfigjson")' \
              "${GITPOD_OBJECTS}/templates/gitpod.yaml" \
              | base64 -d \
              > /tmp/currentconfig.json

            export REGISTRY_SECRET=$(jq -s '.[0] * .[1]' /tmp/userconfig.json /tmp/currentconfig.json | base64 -w 0)

            echo "Gitpod: update the in-cluster registry secret"
            yq eval-all --inplace '(select(.kind == "Secret" and .metadata.name == env(REGISTRY_SECRET_NAME)) | .data.".dockerconfigjson") |= env(REGISTRY_SECRET)' \
              "${GITPOD_OBJECTS}/templates/gitpod.yaml"
          fi

          echo "Gitpod: Escape any Golang template values"
          sed -i -r 's/(.*\{\{.*)/{{`\1`}}/' "${GITPOD_OBJECTS}/templates/gitpod.yaml"

          # This is to overcome upgrade problems with PodSecurityPolicy removal
          echo "Gitpod: Delete Minio deployment"
          kubectl delete deployments.apps --wait -n gitpod minio || true

          echo "Gitpod: Delete RabbitMQ statefulset"
          kubectl delete statefulsets.apps --wait -n gitpod messagebus || true

          echo "Gitpod: Delete MySQL statefulset"
          kubectl delete statefulsets.apps --wait -n gitpod mysql || true

          echo "Gitpod: Delete container-registry secret"
          kubectl delete secret --wait -n gitpod container-registry || true
          # End of PSP removal fixes

          # If certificate secret already exists, set the timeout to 5m
          CERT_SECRET=$(kubectl get secrets -n gitpod https-certificates -o jsonpath='{.metadata.name}' || echo '')
          HELM_TIMEOUT="10m"
          if [ "${CERT_SECRET}" = "" ]; then
            HELM_TIMEOUT="1h"
          fi

          # The long timeout is to ensure the TLS cert is created (if required)
          echo "Gitpod: Apply the Kubernetes objects with timeout of ${HELM_TIMEOUT}"
          helm upgrade \
            --atomic \
            --cleanup-on-fail \
            --create-namespace \
            --install \
            --namespace="gitpod" \
            --reset-values \
            --timeout "${HELM_TIMEOUT}" \
            --wait \
            gitpod \
            "${GITPOD_OBJECTS}"

          echo "Gitpod: Restarting installation status job"
          kubectl delete pod -n gitpod -l component=gitpod-installer-status || true

          echo "Gitpod: Installer job finished - goodbye"
        command:
        - /bin/sh
        - -c
        env:
        - name: CONFIG_FILE
          value: /tmp/gitpod-config.yaml
        - name: CONFIG_PATCH_FILE
          value: /config-patch/gitpod-config-patch.yaml
        - name: CONTAINERD_DIR_K3S
          value: /run/k3s/containerd/io.containerd.runtime.v2.task/k8s.io
        - name: CONTAINERD_SOCKET_K3S
          value: /run/k3s/containerd/containerd.sock
        - name: CONTAINERD_DIR_AL
          value: /run/containerd/io.containerd.runtime.v2.task/k8s.io
        - name: CONTAINERD_SOCKET_AL
          value: /run/containerd/containerd.sock
        - name: GITPOD_OBJECTS
          value: /tmp/gitpod
        image: eu.gcr.io/gitpod-core-dev/build/installer:release-2022.08.0.10
        name: installer
        volumeMounts:
        - mountPath: /config-patch
          name: config-patch
          readOnly: true
        - mountPath: /mnt/node0
          name: node-fs0
          readOnly: true
      imagePullSecrets:
      - name: gitpod-registry
      restartPolicy: OnFailure
      serviceAccountName: installer
      volumes:
      - configMap:
          name: gitpod-config-patch
        name: config-patch
      - hostPath:
          path: /
          type: Directory
        name: node-fs0
  ttlSecondsAfterFinished: 0
---
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    kots.io/app-slug: gitpod
  labels:
    app: gitpod
    component: shiftfs-module-loader
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: shiftfs-module-loader-18
spec:
  activeDeadlineSeconds: 30
  backoffLimit: 1
  parallelism: 1
  template:
    metadata:
      annotations:
        kots.io/app-slug: gitpod
      labels:
        app: gitpod
        component: shiftfs-module-loader
        kots.io/app-slug: gitpod
        kots.io/backup: velero
    spec:
      containers:
      - image: eu.gcr.io/gitpod-core-dev/build/shiftfs-module-loader:commit-9fbb1f3b46ccdf12850005f0abab0eb2adc8cdb1
        name: shiftfs-module-loader
        securityContext:
          privileged: true
        volumeMounts:
        - mountPath: /usr/src_node
          name: node-linux-src
          readOnly: true
      imagePullSecrets:
      - name: gitpod-registry
      restartPolicy: Never
      serviceAccountName: installer
      volumes:
      - hostPath:
          path: /usr/src
          type: Directory
        name: node-linux-src
  ttlSecondsAfterFinished: 60
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  annotations:
    kots.io/app-slug: gitpod
    kots.io/when: "true"
  labels:
    app: gitpod
    component: gitpod-installer
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: https-certificates
spec:
  dnsNames:
  - gitpod.vyas-n.com
  - '*.gitpod.vyas-n.com'
  - '*.ws.gitpod.vyas-n.com'
  issuerRef:
    kind: ClusterIssuer
    name: zerossl-prod
  secretName: https-certificates
  secretTemplate:
    labels:
      app: gitpod
      component: gitpod-installer
      kots.io/app-slug: gitpod
      kots.io/backup: velero
---
apiVersion: v1
kind: Pod
metadata:
  annotations:
    helm.sh/hook: test-success
    kots.io/app-slug: gitpod
  labels:
    app.kubernetes.io/instance: fluent-bit
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: fluent-bit
    app.kubernetes.io/version: 1.9.4
    helm.sh/chart: fluent-bit-0.20.2
    kots.io/app-slug: gitpod
    kots.io/backup: velero
  name: fluent-bit-test-connection
spec:
  containers:
  - args:
    - fluent-bit:2020
    command:
    - wget
    image: busybox:latest
    imagePullPolicy: Always
    name: wget
  imagePullSecrets:
  - name: gitpod-registry
  restartPolicy: Never
